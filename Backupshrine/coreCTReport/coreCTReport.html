<template>
    <lightning-card>
        <div class="SE-content">
            <template if:true={isSectionVisible}>
                <div class="SE-Card secondDivForSearching">
                    <!-- Regular Deposits View -->
                    <template if:true={isRegularDeposits}>
                        <!-- Header and controls section -->
                        <div class="slds-grid slds-grid_align-spread">
                            <div class="slds-col">
                                <h1 class="headingClass">Regular Bank Deposits</h1>
                            </div>
                            <template if:true={isSectionVisible}>
                                <div class="slds-grid slds-grid_align-end slds-m-bottom_medium">
                                    <div class="buttoncontainerfilter">
                                        <div class="right-buttons">
                                            <lightning-badge data-id="today" label="Today" class={badgeClassCurrentDay} onclick={handleBadgeClick}></lightning-badge>
                                            <lightning-badge data-id="this-week" label="This Week" class={badgeClassThisWeek} onclick={handleBadgeClick}></lightning-badge>
                                            <lightning-badge data-id="this-month" label="This Month" class={badgeClassThisMonth} onclick={handleBadgeClick}></lightning-badge>
                                            <lightning-badge data-id="this-quarter" label="This Quarter" class={badgeClassThisQuarter} onclick={handleBadgeClick}></lightning-badge>
                                            <lightning-badge data-id="this-year" label="This Year" class={badgeClassThisYear} onclick={handleBadgeClick}></lightning-badge>
                                            <div class="export-button" title="Export to Excel" onclick={handleExportRegularButtonClick}>
                                                <lightning-icon icon-name="doctype:excel" size="xx-small" alternative-text="Excel Icon"></lightning-icon>
                                                <span>Export to Excel</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <template for:each={paymentSections} for:item="section">
                            <template if:true={section.hasRecords}>
                                <div key={section.type} class="payment-type-section slds-m-bottom_medium">
                                    <div class="left-button slds-p-left_small">
                                        <h2 class="slds-text-title_bold slds-m-right_x-small search-css">{section.title}</h2>
                                        <lightning-badge label={section.count} class="slds-badge_inverse result-no-css"></lightning-badge>
                                    </div>
                                    <div class="slds-scrollable_x custom-table-wrapper">
                                        <table class="slds-table slds-table_cell-buffer slds-table_bordered custom-table">
                                            <thead>
                                                <tr class="custom-header">
                                                    <th scope="col">Speed Type</th>
                                                    <th scope="col">Activity Description</th>
                                                    <th scope="col">Activity Code</th>
                                                    <th scope="col">Amount</th>
                                                    <th scope="col">Transaction Date</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <template for:each={section.records} for:item="row">
                                                    <tr key={row.Id}>
                                                        <td>{row.Speed_Typec}</td>
                                                        <td>{row.Select_Activityc}</td>
                                                        <td>{row.Select_Sub_Activityc}</td>
                                                        <td>
                                                            <lightning-formatted-number value={row.FeeAmountc} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                        </td>
                                                        <td>
                                                            <lightning-formatted-date-time value={row.Transaction_Datec} year="numeric" month="numeric" day="numeric"></lightning-formatted-date-time>
                                                        </td>
                                                    </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </template>
                        </template>

                        <template if:true={isResultEmpty}>
                            <div class="no-result-found">
                                <h1 class="no-result-found-label">No Results Found</h1>
                            </div>
                        </template>
                    </template>

                    <!-- Credit Card Deposits View -->
                    <template if:false={isRegularDeposits}>
                        <div class="slds-grid slds-grid_align-spread">
                            <div class="slds-col" style="display: flex;">
                                <h1 class="headingClass">Credit Card Deposits &nbsp;</h1>
                                <lightning-badge label={brsRecordsCount} class="slds-badge_inverse creditCardCount"></lightning-badge>
                            </div>
                            <template if:true={isSectionVisible}>
                                <div class="slds-grid slds-grid_align-end slds-m-bottom_medium">
                                    <div class="buttoncontainerfilter">
                                        <div class="right-buttons">
                                            <lightning-badge data-id="today" label="Today" class={badgeClassCurrentDay} onclick={handleBadgeClick}></lightning-badge>
                                            <lightning-badge data-id="this-week" label="This Week" class={badgeClassThisWeek} onclick={handleBadgeClick}></lightning-badge>
                                            <lightning-badge data-id="this-month" label="This Month" class={badgeClassThisMonth} onclick={handleBadgeClick}></lightning-badge>
                                            <lightning-badge data-id="this-quarter" label="This Quarter" class={badgeClassThisQuarter} onclick={handleBadgeClick}></lightning-badge>
                                            <lightning-badge data-id="this-year" label="This Year" class={badgeClassThisYear} onclick={handleBadgeClick}></lightning-badge>
                                            <div class="export-button" title="Export to Excel" onclick={handleExportCreditcardButtonClick}>
                                                <lightning-icon icon-name="doctype:excel" size="xx-small" alternative-text="Excel Icon"></lightning-icon>
                                                <span>Export to Excel</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div class="payment-type-section slds-m-bottom_medium">
                            <div class="slds-scrollable_x custom-table-wrapper">
                                <template if:true={hasBRSRecords}>
                                    <table class="slds-table slds-table_cell-buffer slds-table_bordered custom-table">
                                        <thead>
                                            <tr class="custom-header">
                                                <th scope="col">Speed Type</th>
                                                <th scope="col">Activity Description</th>
                                                <th scope="col">Activity Code</th>
                                                <th scope="col">Master Card</th>
                                                <th scope="col">Visa</th>
                                                <th scope="col">Amex</th>
                                                <th scope="col">Discover</th>
                                                <th scope="col">American Express</th>
                                                <th scope="col">JCB</th>
                                                <th scope="col">Diners Club</th>
                                                <th scope="col">Unknown</th>
                                                <th scope="col">Total Amount</th>
                                                <th scope="col">Transaction Date</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template for:each={paginatedData} for:item="trans">
                                                <tr key={trans.Id}>
                                                    <td>{trans.Speed_Type__c}</td>
                                                    <td>{trans.Select_Activity__c}</td>
                                                    <td>{trans.Activity_Code__c}</td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.MasterCardAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.VisaAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.AmexAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.DiscoverAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.AmericanExpressAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.JCBAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.DinersClubAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.UnknownAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-number value={trans.TotalAmount} format-style="currency" currency-code="USD"></lightning-formatted-number>
                                                    </td>
                                                    <td>
                                                        <lightning-formatted-date-time value={trans.Transaction_Date__c} year="numeric" month="numeric" day="numeric"></lightning-formatted-date-time>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </template>

                                <template if:true={showPagination}>
                                    <div class="pagination-container">
                                        <lightning-button class="pagination-button" label="<< Prev" onclick={handlePreviousPage}
                                            disabled={isPreviousDisabled} variant="neutral">
                                        </lightning-button>
                                
                                        <div class="page-info">
                                            <span class="page-range">{startRange}-{endRange} of {totalRecords} &nbsp;</span>
                                            <span class="page-text"> | Page &nbsp;
                                                <lightning-input 
                                                type="number" 
                                                value={currentPage} 
                                                label="Current Page" 
                                                variant="label-hidden"
                                                class="current-page-input"
                                                onchange={handlePageChange}>
                                                </lightning-input> &nbsp;
                                                of {totalPages}
                                            </span>
                                        </div>
                                
                                        <lightning-button class="pagination-button" label="Next >>" onclick={handleNextPage}
                                            disabled={isNextDisabled} variant="neutral">
                                        </lightning-button>
                                    </div>
                                </template>

                                <template if:false={hasBRSRecords}>
                                    <div class="no-result-found">
                                        <h1 class="no-result-found-label">No Results Found</h1>
                                    </div>
                                </template>
                                
                            </div>
                        </div>

                    </template>

                </div>
            </template>
        </div>
    </lightning-card>

    <c-excel-export-finsys></c-excel-export-finsys>

</template>