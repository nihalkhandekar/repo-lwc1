@isTest
public class brs_DateForfeitureBatch_Test {
    @testSetup static void dataSetup(){
        Account acc = BRS_TestDataFactory.createAccountObject();
        Contact con = BRS_TestDataFactory.createContactObject(acc.Id);
        Work_Order__c workorder =BRS_TestDataFactory.createWorkOrderObject(con.Id, 'Online', 'Completed');
        OnOff_Filing_Auto_Refund__c onoff = BRS_TestDataFactory.onOffCustomSetting();
    }
    @isTest static void executeBatchTest(){
        Test.startTest();
        Id RecordTypeIdCloseReinstate = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Close / Reinstate').getRecordTypeId();
        Account ac = [Select id, citizenship__c, business_type__c,Date_Intend_Forfeited__c from account limit 1];
        Business_Filing__c filing = new Business_Filing__c();
        filing.recordtypeid=RecordTypeIdCloseReinstate ;
        filing.Account__c=ac.Id;
        filing.Filing_Fee__c=30;
        filing.Type__c = 'Administrative Dissolution';
        filing.Citizenship__c = ac.citizenship__c;
        filing.business_type__c = ac.business_type__c;
        filing.Filing_Date__c = System.Today().addDays(-30);
        filing.Due_Date__c = (System.today() + 5);
        filing.Status__c=System.label.Approved;
        filing.Filing_Date__c=System.today();
        filing.Filing_Type__c ='Notice of Intent to Dissolve/Revoke';
        filing.Date_Intend_Forfeited__c =System.today();
        insert filing;
        ac.Date_Intend_Forfeited__c  = null;
        update ac;
        String query='SELECT ID,Account__c,Date_Intend_Forfeited__c,Filing_Type__c,Type__c,Filing_Date__c FROM Business_Filing__c WHERE Status__c in: filingStatus and Account__c != null and (Filing_Type__c in: filingTypes or Type__c in: filingTypes2) and Account__r.status__c in: statuses'; 
        brs_DateForfeitureBatch bmr=new brs_DateForfeitureBatch(query);
        Database.executeBatch(bmr,50);
        Test.stopTest();
    }
     @isTest static void executeBatchTest2(){
        Test.startTest();
        Id RecordTypeIdCloseReinstate = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Close / Reinstate').getRecordTypeId();
        Id mainRecTypeId = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Annual Report / First Report').getRecordTypeId();        
        Account ac = [Select id, citizenship__c, business_type__c,Date_Intend_Forfeited__c from account limit 1];
        Agent__c ag = BRS_TestDataFactory.createAgent(ac.Id);
        List<Business_Filing__c> lstFile = new List<Business_Filing__c>();
        Business_Filing__c filing = new Business_Filing__c();
        filing.recordtypeid=RecordTypeIdCloseReinstate ;
        filing.Account__c=ac.Id;
        filing.Filing_Fee__c=30;
        filing.Type__c = 'Administrative Dissolution';
        filing.Citizenship__c = ac.citizenship__c;
        filing.business_type__c = ac.business_type__c;
        filing.Filing_Date__c = System.Today().addDays(-30);
        filing.Due_Date__c = (System.today() + 5);
        filing.Status__c=System.label.Approved;
        filing.Filing_Type__c ='Notice of Intent to Dissolve/Revoke';
        filing.Date_Intend_Forfeited__c =System.today();
        lstFile.add(filing);
        Business_Filing__c filing3 = new Business_Filing__c();
        filing3.recordtypeid=mainRecTypeId;
        filing3.Account__c=ac.Id;
        filing3.Filing_Fee__c=30;
        filing3.Type__c = 'Annual Report';
        filing3.Citizenship__c = ac.citizenship__c;
        filing3.business_type__c = ac.business_type__c;
        filing3.Filing_Date__c = System.Today().addDays(-30);
        filing3.Due_Date__c = System.today().addDays(-366);
        filing3.Status__c='Past Due';
        filing3.Filing_Date__c=System.today();
        filing3.Date_Intend_Forfeited__c =System.today().addDays(2);
        lstFile.add(filing3);
        insert lstFile;
        ac.Status__c = 'Forfeited';
        update ac;
        Business_Filing__c filing2 = new Business_Filing__c();
        filing2.recordtypeid=RecordTypeIdCloseReinstate ;
        filing2.Account__c=ac.Id;
        filing2.Filing_Fee__c=30;
        filing2.Type__c = 'Reinstatement';
        filing2.Citizenship__c = ac.citizenship__c;
        filing2.business_type__c = ac.business_type__c;
        filing2.Filing_Date__c = System.Today();
        filing2.Due_Date__c = (System.today() + 5);
        filing2.Status__c=System.label.Approved;
        filing2.Date_Intend_Forfeited__c =System.today().addDays(2);
        insert filing2;
        ac.Status__c = 'Active';
        ac.Date_Intend_Forfeited__c  = null;
        update ac;
        
        String query='SELECT ID,Account__c,Date_Intend_Forfeited__c,Filing_Type__c,Type__c,Filing_Date__c FROM Business_Filing__c WHERE Status__c in: filingStatus and Account__c != null and (Filing_Type__c in: filingTypes or Type__c in: filingTypes2) and Account__r.status__c in: statuses'; 
        brs_DateForfeitureBatch bmr=new brs_DateForfeitureBatch(query);
        Database.executeBatch(bmr,50);
        Test.stopTest();
    }
    
    @isTest static void executeBatchTest4(){
        Test.startTest();
        Id RecordTypeIdCloseReinstate = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Close / Reinstate').getRecordTypeId();
        Id mainRecTypeId = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Annual Report / First Report').getRecordTypeId();        
        Account ac = [Select id, citizenship__c, business_type__c,Date_Intend_Forfeited__c from account limit 1];
        Agent__c ag = BRS_TestDataFactory.createAgent(ac.Id);
        List<Business_Filing__c> lstFile = new List<Business_Filing__c>();
        Business_Filing__c filing = new Business_Filing__c();
        filing.recordtypeid=RecordTypeIdCloseReinstate ;
        filing.Account__c=ac.Id;
        filing.Filing_Fee__c=30;
        filing.Type__c = 'Administrative Dissolution';
        filing.Citizenship__c = ac.citizenship__c;
        filing.business_type__c = ac.business_type__c;
        filing.Filing_Date__c = System.Today().addDays(-30);
        filing.Due_Date__c = (System.today() + 5);
        filing.Status__c=System.label.Approved;
        filing.Filing_Type__c ='Notice of Intent to Dissolve/Revoke';
        filing.Date_Intend_Forfeited__c =System.today();
        lstFile.add(filing);
        Business_Filing__c filing3 = new Business_Filing__c();
        filing3.recordtypeid=mainRecTypeId;
        filing3.Account__c=ac.Id;
        filing3.Filing_Fee__c=30;
        filing3.Type__c = 'First Report';
        filing3.Citizenship__c = ac.citizenship__c;
        filing3.business_type__c = ac.business_type__c;
        filing3.Filing_Date__c = System.Today().addDays(-30);
        filing3.Due_Date__c = System.today().addDays(-366);
        filing3.Status__c='Past Due';
        filing3.Filing_Date__c=System.today();
        filing3.Date_Intend_Forfeited__c =System.today().addDays(2);
        lstFile.add(filing3);
        insert lstFile;
        ac.Status__c = 'Forfeited';
        update ac;
        Business_Filing__c filing2 = new Business_Filing__c();
        filing2.recordtypeid=RecordTypeIdCloseReinstate ;
        filing2.Account__c=ac.Id;
        filing2.Filing_Fee__c=30;
        filing2.Type__c = 'Reinstatement';
        filing2.Citizenship__c = ac.citizenship__c;
        filing2.business_type__c = ac.business_type__c;
        filing2.Filing_Date__c = System.Today();
        filing2.Due_Date__c = (System.today() + 5);
        filing2.Status__c=System.label.Approved;
        filing2.Date_Intend_Forfeited__c =System.today().addDays(2);
        insert filing2;
        ac.Status__c = 'Active';
        ac.Date_Intend_Forfeited__c  = null;
        update ac;
        
        String query='SELECT ID,Account__c,Date_Intend_Forfeited__c,Filing_Type__c,Type__c,Filing_Date__c FROM Business_Filing__c WHERE Status__c in: filingStatus and Account__c != null and (Filing_Type__c in: filingTypes or Type__c in: filingTypes2) and Account__r.status__c in: statuses'; 
        brs_DateForfeitureBatch bmr=new brs_DateForfeitureBatch(query);
        Database.executeBatch(bmr,50);
        Test.stopTest();
    }
    
    @isTest static void executeBatchTest5(){
        Test.startTest();
        Id RecordTypeIdCloseReinstate = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Close / Reinstate').getRecordTypeId();
        Id mainRecTypeId = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Annual Report / First Report').getRecordTypeId();        
        Account ac = [Select id, citizenship__c, business_type__c,Date_Intend_Forfeited__c from account limit 1];
        List<Business_Filing__c> lstFile = new List<Business_Filing__c>();
        Business_Filing__c filing = new Business_Filing__c();
        filing.recordtypeid=RecordTypeIdCloseReinstate ;
        filing.Account__c=ac.Id;
        filing.Filing_Fee__c=30;
        filing.Type__c = 'Administrative Dissolution';
        filing.Citizenship__c = ac.citizenship__c;
        filing.business_type__c = ac.business_type__c;
        filing.Filing_Date__c = System.Today().addDays(-30);
        filing.Due_Date__c = (System.today() + 5);
        filing.Status__c=System.label.Approved;
        filing.Filing_Type__c ='Notice of Intent to Dissolve/Revoke';
        filing.Date_Intend_Forfeited__c =System.today();
        lstFile.add(filing);
        insert lstFile;
        ac.Status__c = 'Forfeited';
        update ac;
        Business_Filing__c filing2 = new Business_Filing__c();
        filing2.recordtypeid=RecordTypeIdCloseReinstate ;
        filing2.Account__c=ac.Id;
        filing2.Filing_Fee__c=30;
        filing2.Type__c = 'Reinstatement';
        filing2.Citizenship__c = ac.citizenship__c;
        filing2.business_type__c = ac.business_type__c;
        filing2.Filing_Date__c = System.Today();
        filing2.Due_Date__c = (System.today() + 5);
        filing2.Status__c=System.label.Approved;
        filing2.Date_Intend_Forfeited__c =System.today().addDays(2);
        insert filing2;
        ac.Status__c = 'Active';
        ac.Date_Intend_Forfeited__c  = null;
        update ac;
        
        String query='SELECT ID,Account__c,Date_Intend_Forfeited__c,Filing_Type__c,Type__c,Filing_Date__c FROM Business_Filing__c WHERE Status__c in: filingStatus and Account__c != null and (Filing_Type__c in: filingTypes or Type__c in: filingTypes2) and Account__r.status__c in: statuses'; 
        brs_DateForfeitureBatch bmr=new brs_DateForfeitureBatch(query);
        Database.executeBatch(bmr,50);
        Test.stopTest();
    }
    
    @isTest static void executeBatchTest3(){
        Test.startTest();
        Id RecordTypeIdCloseReinstate = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Close / Reinstate').getRecordTypeId();
        Id mainRecTypeId = Schema.SObjectType.Business_Filing__c.getRecordTypeInfosByName().get('Annual Report / First Report').getRecordTypeId();        
        Account ac = [Select id, citizenship__c, business_type__c,Date_Intend_Forfeited__c from account limit 1];
        Agent__c ag = BRS_TestDataFactory.createAgent(ac.Id);
        List<Business_Filing__c> lstFile = new List<Business_Filing__c>();
        Business_Filing__c filing = new Business_Filing__c();
        filing.recordtypeid=RecordTypeIdCloseReinstate ;
        filing.Account__c=ac.Id;
        filing.Filing_Fee__c=30;
        filing.Type__c = 'Administrative Dissolution';
        filing.Citizenship__c = ac.citizenship__c;
        filing.business_type__c = ac.business_type__c;
        filing.Filing_Date__c = System.Today();
        filing.Due_Date__c = (System.today() + 5);
        filing.Status__c=System.label.Approved;
        filing.Filing_Type__c ='Notice of Intent to Dissolve/Revoke';
        filing.Date_Intend_Forfeited__c =System.today();
        lstFile.add(filing);
        Business_Filing__c filing3 = new Business_Filing__c();
        filing3.recordtypeid=mainRecTypeId;
        filing3.Account__c=ac.Id;
        filing3.Filing_Fee__c=30;
        filing3.Type__c = 'Annual Report';
        filing3.Citizenship__c = ac.citizenship__c;
        filing3.business_type__c = ac.business_type__c;
        filing3.Filing_Date__c = System.Today().addDays(-30);
        filing3.Due_Date__c = System.today().addDays(-366);
        filing3.Status__c='Past Due';
        filing3.Filing_Date__c=System.today();
        filing3.Date_Intend_Forfeited__c =System.today().addDays(2);
        lstFile.add(filing3);
        insert lstFile;
        ac.Status__c = 'Forfeited';
        update ac;
        Business_Filing__c filing2 = new Business_Filing__c();
        filing2.recordtypeid=RecordTypeIdCloseReinstate ;
        filing2.Account__c=ac.Id;
        filing2.Filing_Fee__c=30;
        filing2.Type__c = 'Reinstatement';
        filing2.Citizenship__c = ac.citizenship__c;
        filing2.business_type__c = ac.business_type__c;
        filing2.Filing_Date__c = System.Today().addDays(-30);
        filing2.Due_Date__c = (System.today() + 5);
        filing2.Status__c=System.label.Approved;
        filing2.Date_Intend_Forfeited__c =System.today().addDays(2);
        insert filing2;
        ac.Status__c = 'Active';
        ac.Date_Intend_Forfeited__c  = null;
        update ac;
        
        String query='SELECT ID,Account__c,Date_Intend_Forfeited__c,Filing_Type__c,Type__c,Filing_Date__c FROM Business_Filing__c WHERE Status__c in: filingStatus and Account__c != null and (Filing_Type__c in: filingTypes or Type__c in: filingTypes2) and Account__r.status__c in: statuses'; 
        brs_DateForfeitureBatch bmr=new brs_DateForfeitureBatch(query);
        Database.executeBatch(bmr,50);
        Test.stopTest();
    }
}