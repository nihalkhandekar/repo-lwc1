<template>

    <div class="breadcrumb-container">
        <div class="breadcrumb">
            <a href="#" onclick={navigateToDashboard}>{labels.TrackApostilleRequests}</a>
        </div>
    </div>

    <div class="track-apostille-container">
        <!-- Header Section -->
        <div class="custom-card-header">
            <lightning-icon icon-name="standard:real_time" size="large" class="header-icon"></lightning-icon>
            <div class="header-text">
                <h1 class="title">{labels.TrackApostilleRequests}</h1>
                <p class="description">{labels.Trackyourapostillerequesttoknowtheupdate}</p>
            </div>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <div class="input-group">
                <div class="form-group half-width">
                    <label class="custom-label" for="certificateNumber">{labels.WorkOrder_}</label>
                    <lightning-input label="Work Order#" variant="label-hidden" value={workOrder}
                        onchange={handleInputChange} name="workOrder" class="input-field">
                    </lightning-input>
                </div>

                <div class="form-group half-width">
                    <label class="custom-label" for="certificateNumber">{labels.RequestorName_Individual_Organization}</label>
                    <lightning-input label="Requestor Name" variant="label-hidden" value={requesterName}
                        onchange={handleInputChange} name="requesterName" class="input-field">
                    </lightning-input>
                </div>

                <div class="form-group half-width">
                    <label class="custom-label" for="certificateNumber">{labels.ReceivedDate}</label>
                    <lightning-input label="Requestor Date" type="date" variant="label-hidden" value={requestDate}
                        onchange={handleInputChange} name="requestDate" class="input-field" date-style="short">
                    </lightning-input>
                </div>
            </div>
            <div class="button-group">
                <lightning-button label={labels.Clear} onclick={handleClear} variant="neutral" icon-name="utility:clear"
                    icon-position="left" class="slds-m-right_x-small slds-button_neutral">
                </lightning-button>
                <lightning-button label={labels.Search} onclick={handleSearch} variant="brand" icon-name="utility:search"
                    icon-position="left" class="slds-button_brand">
                </lightning-button>
            </div>
            <template if:true={isLoading}>
                <div class="spinner-container">
                    <lightning-spinner alternative-text="Loading..." variant="brand" size="large"></lightning-spinner>
                </div>
            </template>
            <template if:false={isLoading}>
                <div if:true={showResults}>
                    <template if:true={paginatedResult}>
                        <div class="slds-scrollable_x custom-table-container">
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered custom-table">
                                <thead>
                                    <tr class="custom-header">
                                        <th style="max-width: 200px; min-width: 200px;" scope="col" onclick={sortByField}
                                            data-field="ApplicationID">
                                            <div class="slds-truncate" title="Work Order">{labels.WorkOrder_}
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon" data-my-icon></lightning-icon>
                                            </div>
                                        </th>
                                        <th style="max-width: 125px; min-width: 125px;" scope="col" onclick={sortByField}
                                            data-field="requestorName">
                                            <div class="slds-truncate" title="Requester Name">{labels.RequestorName}
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th style="max-width: 125px; min-width: 125px;" scope="col" onclick={sortByField}
                                            data-field="AppliedDate">
                                            <div class="slds-truncate" title="Received Date">{labels.ReceivedDate}
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th style="max-width: 125px; min-width: 125px;" scope="col" onclick={sortByField}
                                            data-field="ApplicationID">
                                            <div class="slds-truncate" title="Signed By">{labels.SignedBy}
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th style="max-width: 125px; min-width: 125px;" scope="col" onclick={sortByField}
                                            data-field="ApplicationID">
                                            <div class="slds-truncate" title="Capacity">{labels.Capacity}
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th style="max-width: 125px; min-width: 125px;" scope="col" onclick={sortByField}
                                            data-field="ApplicationID">
                                            <div class="slds-truncate" title="Country">{labels.Country}
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th style="max-width: 125px; min-width: 125px;" scope="col" onclick={sortByField}
                                            data-field="ApplicationID">
                                            <div class="slds-truncate" title="Country">{labels.DocumentType}
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th style="max-width: 125px; min-width: 125px;" scope="col" onclick={sortByField}
                                            data-field="Status">
                                            <div class="slds-truncate" title="Status">WO/DOC {labels.Status}
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th style="max-width: 100px; min-width: 100px;" scope="col">
                                            <div class="slds-truncate" title="Action"></div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template if:true={isRecordsLoading}>
                                        <!-- Show loader centered in the table without top and bottom borders -->
                                        <tr class="no-border-row">
                                            <td colspan="9" class="slds-text-align_center loader-row">
                                                <lightning-spinner alternative-text="Loading records..." variant="brand"
                                                    size="large"></lightning-spinner>
                                            </td>
                                        </tr>
                                    </template>
                                    <template if:false={isRecordsLoading}>
                                        <template for:each={paginatedResult} for:item="row">
                                            <tr key={row.Id} class="custom-column">
                                                <td class={row.clickable} data-id={row.Id} onclick={toggleDocument}>
                                                    <div class="slds-truncate" title={row.ApplicationID}>
                                                        <template if:true={row.hasDocuments}
                                                            class="slds-button slds-button_icon slds-m-right_x-small"
                                                            aria-expanded={row.isExpanded}
                                                            aria-controls="documents-{row.Id}">
                                                            <span
                                                                class="slds-icon_container slds-icon-border-filled icon-border">
                                                                <lightning-icon class="upDownIcon" icon-name={row.iconName} size="xx-small"
                                                                    alternative-text="Toggle"></lightning-icon>
                                                            </span>
                                                        </template>
                                                        <template if:true={row.hasDocuments}>
                                                            <span class="tableText">{row.ApplicationID}</span>
                                                            <template if:false={row.isExpanded}>
                                                                <span class="doc-count">+{row.docCount}</span>
                                                            </template>
                                                        </template>
                                                        <template if:false={row.hasDocuments}>
                                                            <span class="tableTextChild">{row.ApplicationID}</span>
                                                        </template>
                                                    </div>
                                                </td>
                                                <td class="column2">
                                                    <div class="slds-truncate" title={row.requestorName}>
                                                        {row.requestorName}</div>
                                                </td>
                                                <td class="column3">
                                                    <div class="slds-truncate" title={row.AppliedDate}>{row.AppliedDate}
                                                    </div>
                                                </td>
                                                <td class="column4">
                                                    <div class="slds-truncate" title={row.signedByName}>
                                                        {row.signedByName}</div>
                                                </td>
                                                <td class="column5">
                                                    <div class="slds-truncate" title={row.signedByPosition}>
                                                        {row.signedByPosition}
                                                    </div>
                                                </td>
                                                <td class="column6">
                                                    <div class="slds-truncate" title={row.docCountry}> {row.docCountry}
                                                        </div>
                                                </td>
                                                <td class="column7">
                                                    <div class="slds-truncate" title={row.documentType}>
                                                        {row.docType}</div>
                                                </td>
                                                <td class="column8">
                                                    <template if:false ={row.isExpanded}>
                                                        <div class={row.unexpandedStatusClass} title={row.unexpandedStatus}>
                                                            {row.unexpandedStatus}
                                                        </div>
                                                    </template>
                                                    <template if:true ={row.isExpanded}>
                                                        <div class={row.expandedStatusClass} title={row.expandedStatus}>
                                                            {row.expandedStatus}
                                                        </div>
                                                    </template>
                                                </td>
                                                <td class="column9">
                                                    <a href="javascript:void(0)" class="actionView" onclick={handleAction}
                                                        data-id={row.Id} data-status={row.status}>
                                                        {labels.View}
                                                    </a>
                                                    <!-- <div></div> -->
                                                </td>
                                            </tr>

                                            <template if:true={row.isExpanded}>
                                                <template for:each={row.documents} for:item="document">
                                                    <tr key={document.Id} class="custom-column-child">
                                                        <td class="column1">
                                                            <div class="slds-truncate tableTextChild" title={document.ApplicationID}>
                                                                {row.ApplicationID}
                                                            </div>
                                                        </td>
                                                        <td class="column2">
                                                            <div class="slds-truncate" title={document.requestorName}>
                                                                {row.requestorName}
                                                            </div>
                                                        </td>
                                                        <td class="column3">
                                                            <div class="slds-truncate" title={document.AppliedDate}>
                                                                {row.AppliedDate}
                                                            </div>
                                                        </td>
                                                        <td class="column4">
                                                            <div class="slds-truncate" title={document.signedByName}>
                                                                {document.signedByName}
                                                            </div>
                                                        </td>
                                                        <td class="column5">
                                                            <div class="slds-truncate"
                                                                title={document.signedByPosition}>
                                                                {document.signedByPosition}
                                                            </div>
                                                        </td>
                                                        <td class="column6">
                                                            <div class="slds-truncate" title={document.docCountry}>
                                                                {document.docCountry}</div>
                                                        </td>
                                                        <td class="column7">
                                                            <div class="slds-truncate" title={document.documentType}>
                                                                {document.docType}</div>
                                                        </td>
                                                        <td class="column8">
                                                            <div class={document.statusClass} title={document.docStatus}>
                                                                {document.docStatus}
                                                            </div>
                                                        </td>
                                                        <td class="column9">
                                                            <!-- <a href="javascript:void(0)" class="actionView"
                                                                onclick={handleAction} data-id={row.Id}>
                                                                View
                                                            </a> -->
                                                        </td>
                                                    </tr>
                                                </template>
                                            </template>

                                        </template>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                        <!-- Pagination controls -->
                        <template if:true={showPages}>
                            <div class="pagination-controls">
                                <lightning-button label={labels.Prev} icon-name="utility:jump_to_left" icon-position="left"
                                    onclick={handlePreviousPage} variant="neutral" disabled={isPreviousDisabled}>
                                </lightning-button>

                                <span class="paginationText">{startRecord} - {endRecord} of {totalRecords} | Page
                                    {currentPage}
                                    of {totalPages}</span>

                                <lightning-button label={labels.Next} icon-name="utility:jump_to_right" icon-position="right"
                                    onclick={handleNextPage} variant="neutral" disabled={isNextDisabled}>
                                </lightning-button>
                            </div>
                        </template>
                    </template>
                    <template if:false={paginatedResult}>
                        <p class="no-data-message">{labels.Norecordsfound}</p>
                    </template>
                </div>
            </template>


        </div>

    </div>
</template>