<template>

    <!-- Input Form Card -->
    <lightning-card if:false={inViewFlow}>
        <div class="slds-grid slds-wrap" >
            <!-- Form Rows -->
            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4" >
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            label="Last Name"
                            id="lastName"
                            name="lastName" 
                            value={lastName} 
                            onchange={handleInputChange}
                            placeholder="Enter Last Name">
                        </lightning-input>
                    </div>
                </div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            label="First Name"
                            id="firstName"
                            name="firstName" 
                            value={firstName} 
                            onchange={handleInputChange}
                            placeholder="Enter First Name">
                        </lightning-input>
                    </div>
                </div>
            </div>

            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            label="Transaction ID"
                            id="transactionId"
                            name="transactionId" 
                            value={transactionId} 
                            onchange={handleInputChange}
                            placeholder="Enter Transaction Id">
                        </lightning-input>
                    </div>
                </div>
            </div>

            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-combobox 
                            name="batchPicklist" 
                            label="Select Batch" 
                            value={batchValue} 
                            placeholder="Select a Batch"
                            options={batches}
                            onchange={handleBatchChange}>
                    </lightning-combobox>
                    </div>
                </div>
            </div>

            <!-- Second Row -->

            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-combobox
                            label="Select Activity"
                            id="activity"
                            name="activity" 
                            value={activity} 
                            options={activityOptions} 
                            onchange={handleActivityChange}>
                        </lightning-combobox>
                    </div>
                </div>
            </div>

            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-combobox 
                            label="Transaction Status"
                            id="transactionStatus"
                            name="transactionStatus" 
                            value={transactionStatus} 
                            options={transactionStatusOptions} 
                            onchange={handleTransactionStatusChange}>
                        </lightning-combobox>
                    </div>
                </div>
            </div>

            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-combobox 
                            label="Payment Type"
                            id="paymentType"
                            name="paymentType" 
                            value={paymentType} 
                            options={paymentTypeOptions} 
                            onchange={handlePaymentTypeChange}>
                        </lightning-combobox>
                    </div>
                </div>
            </div>

            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            id="chequeNo"
                            name="chequeNo" 
                            value={chequeNo} 
                            onchange={handleInputChange}
                            placeholder="Check/CC #">
                        </lightning-input>
                    </div>
                </div>
            </div>

            <!-- Third Row -->
            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            label="Transaction From Date"
                            id="transactionFromDate"
                            type="date" 
                            name="transactionFromDate" 
                            value={transactionFromDate} 
                            onchange={handleInputChange}
                            placeholder="Select the date">
                        </lightning-input>
                    </div>
                </div>
            </div>

            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            label="Transaction To Date"
                            id="transactionToDate"
                            type="date" 
                            name="transactionToDate" 
                            value={transactionToDate} 
                            onchange={handleInputChange}
                            placeholder="Select the date">
                        </lightning-input>
                    </div>
                </div>
            </div>

            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            label="Transaction Amount"
                            id="transactionAmount"
                            name="transactionAmount" 
                            value={transactionAmount} 
                            onchange={handleTransactionAmountChange}
                            placeholder="Transaction Amount">
                        </lightning-input>
                    </div>
                </div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-4">
                <div class="slds-form-element">
                    <div class="slds-form-element__control">
                        <lightning-input 
                            label="Customer ID"
                            id="customerId"
                            name="customerId" 
                            value={customerId} 
                            onchange={handleInputChange}
                            placeholder="Enter Customer Id">
                        </lightning-input>
                    </div>
                </div>
            </div>
        </div>

        <!-- Button Container -->
        <div class="slds-grid slds-grid_align-end slds-m-top_medium ">
            <div class="slds-col slds-size_auto slds-p-around_small">
                <lightning-button 
                    label="Clear all" 
                    onclick={handleClear}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button 
                    label="Search" 
                    onclick={handleSearch} 
                    variant="brand">
                </lightning-button>
            </div>
        </div>
    </lightning-card>
    
    <!-- Data Table Card -->
    <lightning-card>
        <!-- Filter Section -->
         <div class="slds-grid slds-grid_align-end slds-m-bottom_medium" if:false={inViewFlow}>
            <div class="button-container">
                <div class="left-button slds-p-left_small">
                    <span class="slds-text-title_bold slds-m-right_x-small">Transactions:</span>
                    <lightning-badge
                        label={transactionsFoundLabel} 
                        class="slds-badge_inverse">
                    </lightning-badge>
                </div>
                <div class="right-buttons">
                    <lightning-badge
                        data-id="current-day"
                        label="Current day"
                        class={badgeClassCurrentDay}
                        onclick={handleBadgeClick}>
                    </lightning-badge>
                    <lightning-badge
                        data-id="this-week" 
                        label="This week"
                        class={badgeClassThisWeek}
                        onclick={handleBadgeClick}>
                    </lightning-badge>
                    <lightning-badge
                        data-id="this-month"
                        label="This month"
                        class={badgeClassThisMonth}
                        onclick={handleBadgeClick}>
                    </lightning-badge>
                    <lightning-badge
                        data-id="this-quarter"
                        label="This quarter"
                        class={badgeClassThisQuarter}
                        onclick={handleBadgeClick}>
                    </lightning-badge>
                    <lightning-badge
                        data-id="this-year"
                        label="This year"
                        class={badgeClassThisYear}
                        onclick={handleBadgeClick}>
                    </lightning-badge>                   
                    
                    <lightning-button-menu
                    icon-position="right"
                    data-id="filterMenu"
                    alternative-text="Filter By Amount"
                    title="Filter"
                    tooltip="Filter by amount"
                    icon-name="utility:filterList"
                    onselect={handleFilterSelect}
                    class="slds-button_icon slds-button_icon-inverse custom-button-menu">
                    <lightning-menu-item label="$0 - $100" value="0-100"></lightning-menu-item>
                    <lightning-menu-item label="$101 - $500" value="101-500"></lightning-menu-item>
                    <lightning-menu-item label="$501 - $1000" value="501-1000"></lightning-menu-item>
                    <lightning-menu-item label="$1001 and above" value="1001+"></lightning-menu-item>
                </lightning-button-menu>
                <span class="slds-text-body_regular slds-m-right_small custom-label" onclick={handleFilterClick}>Filter by amount</span>
                <lightning-button
                    label="+ Add New"
                    onclick={handleAddNewTransactionButtonClick}
                    variant="brand"
                    class="slds-m-right_small"
                ></lightning-button>
                <lightning-button
                    label="Export Result"
                    onclick={handleExportResultButtonClick}
                    variant="brand"
                    class="slds-m-right_small"
                ></lightning-button>
                </div>
            
                <c-modal-flow data-id="modalFlow" flow-name="Get_The_Account_Details" flow-title="Add New Transaction"></c-modal-flow>
            </div>
        

            <template if:true={errorMessage}>
                <div class="slds-text-color_error slds-m-top_medium">
                    {errorMessage}
                </div>
            </template>
         </div>
         <template if:false={inViewFlow}>
            <c-transaction-data-table
                        key-field="Id"
                        columns={columns}
                        data={TrxnfeeItems} 
                        onview ={handleOnView}
                        onprint={handleOnPrint}
                        onrefund={handleOnRefund}  
                        onsort={handleSort}
                        sorted-by={sortedBy}
                        sorted-direction={sortedDirection}
                        hide-checkbox-column>
            </c-transaction-data-table>
        </template>
        <template if:true={inViewFlow}>
            <c-transaction-data-table
                key-field="Id"
                columns={columns}
                data={TrxnfeeItemsByCustomerId}
                onview ={handleOnView}
                onprint={handleOnPrint}
                onrefund={handleOnRefund}    
                onsort={handleSort}  
                sorted-by={sortedBy}
                sorted-direction={sortedDirection}
                hide-checkbox-column>
            </c-transaction-data-table>
        </template>
        <template if:true={isShowFlowModal}>
            <div class="slds-backdrop slds-backdrop_open"></div>
            <section role="dialog" tabindex="-1" aria-modal="true" aria-label="Meaningful description of the modal content" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container slds-modal_full custom-modal-full">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={handleCloseModal}>
                        <lightning-icon class="custom-close-icon" icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <div class="slds-modal__content slds-p-around_medium slds-modal__content_headless" id="modal-content-id-1">
                        <lightning-flow
                            flow-api-name={flowApiName}
                            flow-input-variables={flowInputVariables}
                            onstatuschange={handleFlowStatusChange}
                        >
                        </lightning-flow>
                    </div>
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick={handleCloseModal} aria-label="Cancel and close">Close</button>
                    </div>
                </div>
            </section>
        </template>

        <!-- pagination component -->
        
        <c-pagination
            page-size={pageSize} 
            totalrecords={totalRecords} 
            onpagination={handlePagination}>
        </c-pagination>


        <c-pdf-genrator data-id="pdfGenerator"></c-pdf-genrator>
        <c-excel-with-filtered-data data-id="excelWithFilteredData"></c-excel-with-filtered-data>


    </lightning-card>

</template>