<template>
    <lightning-card>
        <div class="SE-mainBody">
            <div class="SE-content">
                <div class="SE-Card">
                    <div class="SE-searchCardHeader">
                        <div class="SE-searchCardHeaderIcon">
                            <lightning-icon icon-name="standard:search" size="medium"></lightning-icon>
                        </div>
                        <div class="SE-searchCardHeaderTitle">
                            <div class="SE-searchCardHeaderTitleText">
                                Search
                            </div>
                        </div>
                    </div>
                    <div class="SE-searchCardContent searchInputFieldsAndComboboxContainer">
                        <div>
                            <lightning-layout>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-notvalidate" label="Work Order #" id="workOrderNumber"
                                        name="workOrderNumber" type="text" value={workOrderNumber} onchange={handleInputChange}
                                        placeholder="e.g 32145">
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-searchCardInputLabel" label="Last Name" id="lastName"
                                        name="lastName" type="text" pattern="[A-Za-z]+" message-when-pattern-mismatch="Last name should only contain letters." value={lastName} onchange={handleInputChange}
                                        placeholder="e.g Doe">
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-searchCardInputLabel" label="First Name" id="firstName"
                                        name="firstName" type="text" value={firstName} pattern="[A-Za-z]+" message-when-pattern-mismatch="First name should only contain letters." onchange={handleInputChange}
                                        placeholder="e.g John">
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-combobox class="SE-notvalidate" label="Reason for Returned Check" id="reasonReturnedCheck"
                                        name="reasonReturnedCheck" value={reasonReturnedCheck} options={reasonReturnedCheckOptions}
                                        onchange={handleInputChange} placeholder="Select Reason">
                                </lightning-combobox>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-notvalidate" label="SAmount" id="amount"
                                        name="amount" value={amount} 
                                        onchange={handleInputChange} placeholder="e.g. $60.00">
                                    </lightning-input>
                                </lightning-layout-item>
                            </lightning-layout>
                        </div>
                        <div>
                            <lightning-layout>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-notvalidate" label="Check #"
                                        id="check" name="check" value={check}
                                        onchange={handleInputChange} placeholder="e.g. $60.00">
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                <lightning-input class="SE-notvalidate" label="Date" id="date"
                                        name="date" type="date" value={date} 
                                        onchange={handleInputChange} date-style="short" placeholder="mm/dd/yyyy">
                                    </lightning-input>
                                </lightning-layout-item>
                            </lightning-layout>
                        </div>
                    </div>
                    
                    <div class="SE-footer">
                        <div class="button-group">
                            <div class="clear-all" onclick={handleClear}>
                                <span class="clear-icon-wrapper">
                                    <lightning-icon icon-name="utility:close" size="xx-small" class="clear-icon"></lightning-icon>
                                </span>
                                <span class="clear-text">Clear All</span>
                            </div>
                            <lightning-button icon-name="utility:search" variant="brand" alternative-text="Search"
                                label="Search" onclick={handleSearch} title="Search" class="customButton">
                            </lightning-button>
                        </div>
                    </div>
                </div>
                <template if:true={isLoading}>
                    <div class="spinner-container">
                        <lightning-spinner alternative-text="Loading..." variant="brand" size="large"></lightning-spinner>
                    </div>
                </template>
                <template if:false={isLoading}>
                    <div class="SE-Card SE-searchCardContent">
                    <div class="slds-grid slds-grid_align-end">
                        <div class="buttoncontainerfilter">

                            <div class="left-button">
                                <span class="slds-text-title_bold slds-m-right_x-small">Search Result:</span>
                                <lightning-badge label={recordCountLabel} class="totoalcountbadge">
                                </lightning-badge>
                            </div>

                            <div class="right-buttons">
                                <lightning-badge data-id="today" label="Today" class={badgeClassCurrentDay}
                                    onclick={handleBadgeClick}>
                                </lightning-badge>
                                <lightning-badge data-id="this-week" label="This Week" class={badgeClassThisWeek}
                                    onclick={handleBadgeClick}>
                                </lightning-badge>
                                <lightning-badge data-id="this-month" label="This Month" class={badgeClassThisMonth}
                                    onclick={handleBadgeClick}>
                                </lightning-badge>
                                <lightning-badge data-id="this-quarter" label="This Quarter"
                                    class={badgeClassThisQuarter} onclick={handleBadgeClick}>
                                </lightning-badge>
                                <lightning-badge data-id="this-year" label="This Year" class={badgeClassThisYear}
                                    onclick={handleBadgeClick}>
                                </lightning-badge>

                                <lightning-button-menu 
                                icon-position="right" 
                                data-id="filterMenu"
                                alternative-text="Filter By Amount" 
                                label={amountFilterLabel} 
                                icon-name="utility:filterList"
                                menu-alignment="right"
                                onselect={handleAmountFilterChange}>
                                <lightning-menu-item value="0-50" label="$0 - $50"></lightning-menu-item>
                                <lightning-menu-item value="51-100" label="$51 - $100"></lightning-menu-item>
                                <lightning-menu-item value="101-200" label="$101 - $200"></lightning-menu-item>
                                <lightning-menu-item value="201-300" label="$201 - $300"></lightning-menu-item>
                                <lightning-menu-item value="301-400" label="$301 - $400"></lightning-menu-item>
                                <lightning-menu-item value="all" label="All Amounts"></lightning-menu-item>
                        </lightning-button-menu>

                            </div>
                        </div>
                    </div>
                    <template if:true={hasResults}>
                        <div class="slds-scrollable_x custom-table-container">
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered custom-table">
                                <thead>
                                    <tr class="custom-header">
                                        <th scope="col" onclick={sortByField} class={sortedcheckNumber} data-field="checkNumber">
                                            <div class="slds-truncate" title="Check #">Check #
                                                <lightning-icon icon-name={sortIcons.checkNumber} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} class={sortedlastName} data-field="lastName">
                                            <div class="slds-truncate" title="Last Name">Last Name
                                                <lightning-icon icon-name={sortIcons.lastName} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} class={sortedfirstName} data-field="firstName">
                                            <div class="slds-truncate" title="First Name">First Name
                                                <lightning-icon icon-name={sortIcons.firstName} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} class={sortedreturnReason} data-field="returnReason">
                                            <div class="slds-truncate" title="Reason for Returned Check">Reason for Returned Check
                                                <lightning-icon icon-name={sortIcons.returnReason} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} class={sortedactivityAmount} data-field="activityAmount">
                                            <div class="slds-truncate" title="Activity Amount">Activity
                                                <lightning-icon icon-name={sortIcons.activityAmount} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} class={sortedpaymentAmount} data-field="paymentAmount">
                                            <div class="slds-truncate" title="Payment Amount">Payment Amount
                                                <lightning-icon icon-name={sortIcons.paymentAmount} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col">
                                            <div class="slds-truncate">Delinquent</div>
                                        </th>
                                        <th scope="col" onclick={sortByField} class={sortedtransactionDate} data-field="transactionDate">
                                            <div class="slds-truncate" title="Transaction Date">Transaction Date
                                                <lightning-icon icon-name={sortIcons.transactionDate} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th>

                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template if:true={isRecordsLoading}>
                                        <tr class="no-border-row">
                                            <td colspan="8" class="slds-text-align_center loader-row">
                                                <lightning-spinner alternative-text="Loading records..." variant="brand" size="large"></lightning-spinner>
                                            </td>
                                        </tr>
                                    </template>
                                    <template if:false={isRecordsLoading}>
                                        <template for:each={searchResults} for:item="row">
                                            <tr key={row.Id} class="custom-column">
                                                <td>
                                                    <div class="slds-truncate" title={row.checkNumber}>{row.checkNumber}</div>
                                                </td>
                                                <td>
                                                    <div class="slds-truncate" title={row.lastName}>{row.lastName}</div>
                                                </td>
                                                <td>
                                                    <div class="slds-truncate" title={row.firstName}>{row.firstName}</div>
                                                </td>
                                                <td>
                                                    <lightning-combobox
                                                    class="return-reason-options"
                                                    name="reasonReturnedCheck"
                                                    data-id={row.Id}
                                                    options={reasonReturnedCheckOptions}
                                                    onchange={handleDropdownChange}
                                                    value={row.reasonReturnedCheck}
                                                    placeholder="Select a reason">
                                                </lightning-combobox>
                                                </td>
                                                <td>
                                                    <div class="slds-truncate" title={row.activity}>{row.activity}</div>
                                                </td>
                                                <td>
                                                    <div class="slds-truncate slds-text-align_right" title={row.paymentAmount}>{row.paymentAmount}</div>
                                                </td>
                                                <td>
                                                    <lightning-input 
                                                        type="checkbox" 
                                                        data-id={row.Id}
                                                        name="delinquentCheckbox"
                                                        onchange={handleCheckboxChange}
                                                        checked={row.delinquent}>
                                                    </lightning-input>
                                                </td>
                                                <td>
                                                    <div class="slds-truncate" title={row.transactionDate}>{row.transactionDate}</div>
                                                </td>
                                                <td>
                                                    <template if:true={row.hasDocuments}>
                                                        <div class="uploaded-files">
                                                            <template for:each={row.documents} for:item="file" for:index="index">
                                                                <div key={file.documentId} class="uploaded-file">
                                                                    <div class="fileNameClass">
                                                                        <span class="fileContainer">
                                                                            <lightning-icon icon-name="utility:document_preview" alternative-text="File" size="x-small"></lightning-icon>
                                                                            <span class="fileNameContainer" title={file.filename}>{file.filename}</span>
                                                                        </span>
                                                                    </div>
                                                                    <div>
                                                                        <span class="deleteButtonArea">
                                                                            <lightning-button-icon 
                                                                                    icon-name="utility:delete" 
                                                                                    size="x-small" 
                                                                                    alternative-text="Delete"
                                                                                    data-index={index} 
                                                                                    data-id={row.Id} 
                                                                                    onclick={handleDeleteFile}>
                                                                                </lightning-button-icon>

                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </template>
                                                        </div>
                                                    </template>
                                                    <template if:false={row.hasDocuments}>
                                                        <a href="javascript:void(0);" class="upload-link" data-id={row.Id} onclick={handleUploadLinkClick2}>
                                                            Add Document Here
                                                        </a>
                                                    </template>
                                                </td>
                                            </tr>
                                        </template>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                        <!-- Pagination Controls -->
                        <template if:true={showPages}>
                            <div class="pagination-container">
                                <lightning-button class="pagination-button" label="<< Prev"
                                    onclick={handlePreviousPage} disabled={isPreviousDisabled} variant="neutral">
                                </lightning-button>
    
                                <div class="page-info">
                                    <span class="page-range">{startRecord}-{endRecord} of {totalRecords}</span>
                                    <span class="page-text"> &nbsp; | Page &nbsp;
                                        <lightning-input 
                                            type="number" 
                                            value={currentPage} 
                                            label="Current Page" 
                                            variant="label-hidden"
                                            class="current-page-input"
                                            onchange={handlePageChange}>
                                        </lightning-input> &nbsp;
                                        of {totalPages}
                                    </span>                                   
                                 </div>
    
                                <lightning-button class="pagination-button" label="Next >>" onclick={handleNextPage}
                                    disabled={isNextDisabled} variant="neutral">
                                </lightning-button>
                            </div>
                        </template>

                    </template>
                    <template if:false={hasResults}>
                        <p class="no-data-message">No results found for the given criteria.</p>
                    </template>
                    </div>
                </template>
                </div>
            </div> 
    </lightning-card>

    <template if:true={isModalOpen2}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open modalContainer">
            <div class="slds-modal__container">
                <header class="slds-modal__header headerClass">
                    <div class="headerContainer">
                        <h2 class="headingClass">Add Document</h2>
                        <div class="fileUploadClose">
                            <button class="slds-button slds-button_icon slds-button_icon-inverse closeButton" title="Close" onclick={closeUploadModal2}>
                                <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
                            </button>
                        </div>
                    </div>
                </header>
                <div class="slds-modal__content slds-p-around_medium modalContent">
                    <div class="internalheading">
                        <span class="textClass">Upload Document</span>
                        <span style="color: red;">*</span>
                    </div>
                    <div class="internalBorder">
                        <lightning-input type="file" class="fileUploadContainer"
                            accept=".xlsx, .xls, .csv, .png, .doc, .docx, .pdf"
                            label="Attachment" onchange={handleUploadFinished2}>
                        </lightning-input>
                    </div>
                    <template if:true={currentRowDocuments.length}>
                        <div class="uploaded-files">
                            <template for:each={currentRowDocuments} for:item="file" for:index="index">
                                <div key={file.documentId} class="uploaded-file">
                                    <div class="fileNameClass">
                                        <span class="fileContainer">
                                            <lightning-icon icon-name="utility:document_preview" alternative-text="File" size="x-small"></lightning-icon>
                                            <span class="fileNameContainer" title={file.filename}>{file.filename}</span>
                                        </span>
                                    </div>
                                    <div>
                                        <span class="deleteButtonArea">
                                            <lightning-button-icon icon-name="utility:delete" size="x-small"
                                                alternative-text="Delete" data-index={index} onclick={handleDeleteFile2}>
                                            </lightning-button-icon>
                                        </span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
                <footer class="footerContainer">
                    <div class="footerButtonContainer">
                        <button class="slds-button slds-button_neutral" onclick={closeUploadModal2}>Cancel</button>
                        <button class="slds-button slds-button_brand" onclick={handleUpload2}>Upload</button>
                    </div>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    
</template>