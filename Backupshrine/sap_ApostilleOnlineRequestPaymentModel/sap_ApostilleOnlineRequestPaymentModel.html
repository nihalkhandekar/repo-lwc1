<template>
  <lightning-modal-header class="SE-ModalHeader">
    <div class="SE-ModalHeaderTitle">
      <h2>Add Payment</h2>
    </div>
    <lightning-button-icon icon-name="utility:close" size="large" alternative-text="Close" onclick={cloeModels} class="custom-modal__close"></lightning-button-icon>
  </lightning-modal-header>

  <lightning-modal-body>
    <div class="SE-modalMainBody">
      <div class="SE-modalFormStack">
        <div class="slds-grid SE-modalFormStackSectionInputRow75">
          <div class="slds-col SE-customCol">
            <label class="SE-inputLabel" for="workOrder">Work Order #</label>
            <lightning-input
              label="Work Order #"
              name="workOrder"
              variant="label-hidden"
              id="workOrder"
              value={workOrder}
              placeholder="e.g. 2024-10035"
              type="text"
              disabled></lightning-input>
          </div>
          <div class="slds-col SE-customCol">
            <label class="SE-inputLabel" for="dateOfPayment">Date of Payment</label>
            <lightning-input
              label="Date of Payment"
              name="dateOfPayment"
              variant="label-hidden"
              id="dateOfPayment"
              value={dateOfPayment}
              type="date"
              date-style="short"
              onchange={handleDoPChange}></lightning-input>
          </div>
          <div class="slds-col SE-customCol">
            <label class="SE-inputLabel" for="totalPaymentAmount">Total Fee Amount</label>
            <lightning-input
              label="Total Payment Amount"
              name="TotalFeeAmount"
              variant="label-hidden"
              value={TotalFeeAmount}
              placeholder="e.g. $120.00"
              type="currency"
              disabled></lightning-input>
          </div>
          <div class="slds-col SE-customCol">
            <label class="SE-inputLabel" for="totalPaymentAmount">Total Payment Amount</label>
            <lightning-input
              label="Total Payment Amount"
              name="totalPaymentAmount"
              variant="label-hidden"
              value={totalAmountPayment}
              placeholder="e.g. $120.00"
              type="currency"
              disabled></lightning-input>
          </div>
        </div>

        <div class="SE-modalFormStackSectionHeader">
          <div class="SE-modalFormStackSectionHeaderIcon">
            <lightning-icon icon-name="action:add_contact" size="small"></lightning-icon>
          </div>
          <div class="slds-media__body SE-modalFormStackSectionHeaderTitle">
            <h2 class="slds-text-heading_small headerTitle">Payment Details</h2>
            <p class="slds-text-body_small">Enter payment details to continue further.</p>
          </div>
        </div>
        <div class="SE-modalFormStackSectionContent">
          <div class="slds-grid SE-modalFormStackSectionInputRow">
            <div class="slds-col SE-customCol">
              <label class="SE-inputLabel" for="paymentType"> <span class="required-indicator">*</span>Payment Type </label>
              <lightning-combobox
                label="Payment Type"
                name="paymentType"
                variant="label-hidden"
                value={paymentType}
                placeholder="e.g. Credit Card"
                options={paymentTypeOptions}
                onchange={handleTypeChange}
                required>
              </lightning-combobox>
            </div>

            <template if:true={isCreditCard}>
              <div class="slds-col SE-customCol">
                <label class="SE-inputLabel" for="cardType"> <span class="required-indicator">*</span>Card Type </label>
                <lightning-combobox
                  label="Card Type"
                  name="cardType"
                  variant="label-hidden"
                  value={cardType}
                  placeholder="e.g. Visa"
                  options={cardTypeOptions}
                  onchange={handleInputChange}
                  required>
                </lightning-combobox>
              </div>

              <div class="slds-col SE-customCol">
                <label class="SE-inputLabel" for="last4Digits"> <span class="required-indicator">*</span>Last 4 digits of Credit Card </label>
                <lightning-input
                  label="Last 4 Digits"
                  name="last4Digits"
                  variant="label-hidden"
                  value={last4Digits}
                  placeholder="e.g. 3421"
                  type="number"
                  min="0"
                  max="9999"
                  onchange={handleInputChange}
                  required>
                </lightning-input>
              </div>
            </template>

            <template if:true={isCheck}>
              <div class="slds-col SE-customCol">
                <label class="SE-inputLabel" for="checkNumber"> <span class="required-indicator">*</span>Check # </label>
                <lightning-input
                  label="Cheque Number"
                  name="checkNumber"
                  variant="label-hidden"
                  value={checkNumber}
                  placeholder="e.g 23890"
                  type="text"
                  onchange={handleInputChange}
                  required>
                </lightning-input>
              </div>
            </template>

            <template if:true={isMoneyOrder}>
              <div class="slds-col SE-customCol">
                <label class="SE-inputLabel" for="moneyOrderNo"> <span class="required-indicator">*</span>Money Order No. # </label>
                <lightning-input
                  label="Money Order No."
                  name="moneyOrderNo"
                  variant="label-hidden"
                  value={moneyOrderNo}
                  placeholder="e.g 23890"
                  type="text"
                  onchange={handleInputChange}
                  required>
                </lightning-input>
              </div>
            </template>

            <div class="slds-col SE-customCol">
              <label class="SE-inputLabel" for="paymentAmount"> <span class="required-indicator">*</span>Payment Amount </label>
              <lightning-input
                label="Payment Amount"
                name="paymentAmount"
                variant="label-hidden"
                value={paymentAmount}
                placeholder="e.g. $60.00"
                type="currency"
                onchange={handleInputChange}
                required>
              </lightning-input>
            </div>
            <template if:true={isAdd}>
              <div class="slds-col SE-customCol paymentButtonCss">
                <lightning-button label="Add Payment" variant="brand" icon-name="utility:add" class="save-button" onclick={handleAddPayment}></lightning-button>
              </div>
            </template>
            <template if:true={isEdit}>
              <div class="slds-col SE-customCol paymentButtonCss">
                <lightning-button label="Save Payment" variant="brand" class="save-button" onclick={handleEditPayment}></lightning-button>
              </div>
            </template>
          </div>
        </div>

        <div class="SE-modalFormStackSectionContent">
          <template if:true={previousTrnxnPayment}>
            <table class="slds-table slds-table_cell-buffer slds-table_bordered custom-table">
              <thead class="custom-header">
                <tr>
                  <th scope="col" class="docHeaderText">
                    <div class="slds-truncate" title="Payment Type">Payment Type</div>
                  </th>
                  <th scope="col" class="docHeaderText">
                    <div class="slds-truncate" title="Card Type">Card Type</div>
                  </th>
                  <th scope="col" class="docHeaderText">
                    <div class="slds-truncate" title="Check # / MO # / Last four digits of CC">Check # / MO # / Last four digits of CC</div>
                  </th>
                  <th scope="col" class="docHeaderText">
                    <div class="slds-truncate" title="Amount">Payment Amount</div>
                  </th>
                  <th scope="col" class="docHeaderText">
                    <div class="slds-truncate" title="Date">Date</div>
                  </th>
                  <th scope="col" class="docHeaderText">
                    <div class="slds-truncate" title="Date">Action</div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <template for:each={previousTrnxnPayment} for:item="row">
                  <tr key={row.Id} data-id={row.Id}>
                    <td>
                      <div class="slds-truncate" title={row.Payment_Type__c}>{row.SAP_Payment_Type__c}</div>
                    </td>
                    <td>
                      <div class="slds-truncate" title={row.cardType}>{row.cardType}</div>
                    </td>
                    <td>
                      <div class="slds-truncate" title={row.paymentNumber}>{row.paymentNumber}</div>
                    </td>
                    <td>
                      <div class="slds-truncate slds-text-align_right" title={row.TotalFeeAmount}>{row.TotalFeeAmount}</div>
                    </td>
                    <td>
                      <div class="slds-truncate" title={row.CreatedDate}>{row.CreatedDate}</div>
                    </td>
                    <td>
                      <div class="slds-truncate">
                        <lightning-button-icon
                          icon-name="utility:edit"
                          alternative-text="Edit Transaction"
                          title="Edit Transaction"
                          class="slds-m-right_small"
                          variant="bare"
                          disabled={row.isCommunityUser}
                          onclick={handleEditTransaction}
                          data-id={row.Id}>
                        </lightning-button-icon>

                        <lightning-button-icon
                          icon-name="utility:delete"
                          alternative-text="Delete Transaction"
                          title="Delete Transaction"
                          variant="bare"
                          class="slds-icon-text-error"
                          disabled={row.isCommunityUser}
                          onclick={handleDeleteTransaction}
                          data-id={row.Id}>
                        </lightning-button-icon>
                      </div>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </template>
        </div>
      </div>
    </div>
  </lightning-modal-body>

  <lightning-modal-footer class="SE-modalFooter">
    <div class="slds-button-group">
      <div class="button-left-group">
        <lightning-button
          label="Print Payment Receipt"
          variant="neutral"
          class="button-spacing print-buttons"
          disabled={isHasHistory}
          onclick={handlePrintPaymentReceipt}></lightning-button>
      </div>

      <div class="button-right-group SE-modalFooterButtonGroup">
        <button class="slds-button SE-borderLessButton" onclick={cloeModels}>Cancel</button>
      </div>
    </div>
  </lightning-modal-footer>
  <template if:true={showConfirmationModal}>
    <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01" class="slds-modal slds-fade-in-open">
      <div class="slds-modal__container certificate_container">
        <header class="slds-modal__header">
          <h2 class="slds-text-heading_medium">Confirm Deletion</h2>
        </header>
        <div class="slds-modal__content slds-p-around_small">
          <p>Are you sure you want to delete this Payment?</p>
        </div>
        <footer class="slds-modal__footer printCertiFooter">
          <lightning-button label="No" class="slds-button SE-borderLessButton" onclick={cancelDelete}></lightning-button>
          <lightning-button label="Yes" class="save-button" variant="brand" onclick={confirmDelete}></lightning-button>
        </footer>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
  </template>
  <template if:true={isLoading}>
    <div class="spinner-container">
      <lightning-spinner alternative-text="Loading..." variant="brand" size="large"></lightning-spinner>
    </div>
  </template>
  <c-sap_-toast-message-state-modal></c-sap_-toast-message-state-modal>
  <c-sap_-pdf-genrator data-id="pdfGenerator" records={records}></c-sap_-pdf-genrator>
</template>