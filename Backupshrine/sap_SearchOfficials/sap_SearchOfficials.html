<template>
    <lightning-card>
      <div class="SE-mainBody">
        <div class="SE-content">
          <div class="SE-top">
            <div class="SE-linkLable">Officials</div>
          </div>
  
          <!-- Search card section -->
          <div class="SE-Card firstDivForSearching">
            <div class="SE-searchCardHeader">
              <div class="SE-searchCardHeaderIcon searchTitleHeader">
                <lightning-icon
                  icon-name="standard:search"
                  size="medium"
                ></lightning-icon>
              </div>
              <div class="SE-searchCardHeaderTitle">
                <div class="SE-searchCardHeaderTitleText">Search</div>
              </div>
            </div>
  
            <!-- Search card content with input fields and comboboxes -->
            <div
              class="SE-searchCardContent searchInputFieldsAndComboboxContainer"
            >
              <div>
                <lightning-layout>
                  <!-- Last Name input field -->
                  <lightning-layout-item
                    style="flex-basis: 20%"
                    size="2"
                    class="slds-p-right_medium"
                  >
                    <lightning-input
                      class="SE-searchCardInputLabel"
                      label="Last Name"
                      id="lastName"
                      name="lastName"
                      type="text"
                      pattern="[A-Za-z]+"
                      message-when-pattern-mismatch="Last name should only contain letters."
                      value={lastName}
                      onchange={handleInputChange}
                      onkeydown={handleNameKeyDown}
                      placeholder="e.g Doe"
                    >
                    </lightning-input>
                  </lightning-layout-item>
  
                  <!-- First Name input field -->
                  <lightning-layout-item
                    style="flex-basis: 20%"
                    size="2"
                    class="slds-p-right_medium"
                  >
                    <lightning-input
                      class="SE-searchCardInputLabel"
                      label="First Name"
                      id="firstName"
                      name="firstName"
                      type="text"
                      value={firstName}
                      pattern="[A-Za-z]+"
                      message-when-pattern-mismatch="First name should only contain letters."
                      onchange={handleInputChange}
                      onkeydown={handleNameKeyDown}
                      placeholder="e.g John"
                    >
                    </lightning-input>
                  </lightning-layout-item>
  
                  <!-- Term Start input field -->
                  <lightning-layout-item
                    style="flex-basis: 20%"
                    size="2"
                    class="slds-p-right_medium"
                  >
                    <lightning-input
                      class="SE-notvalidate"
                      label="Term Start"
                      id="termStart"
                      name="termStart"
                      type="date"
                      value={termStart}
                      disabled={indefiniteTerm}
                      onchange={handleInputChange}
                      date-style="short"
                      placeholder="mm/dd/yyyy"
                    >
                    </lightning-input>
                  </lightning-layout-item>
  
                  <!-- Term End input field -->
                  <lightning-layout-item
                    style="flex-basis: 20%"
                    size="2"
                    class="slds-p-right_medium"
                  >
                    <lightning-input
                      class="SE-notvalidate"
                      label="Term End"
                      id="termEnd"
                      name="termEnd"
                      type="date"
                      value={termEnd}
                      disabled={indefiniteTerm}
                      onchange={handleInputChange}
                      date-style="short"
                      placeholder="mm/dd/yyyy"
                    >
                    </lightning-input>
                  </lightning-layout-item>
  
                  <!-- Position combobox -->
                  <lightning-layout-item style="flex-basis: 20%" size="2">
                    <lightning-combobox
                      class="SE-notvalidate comboboxItemBackgroundColorChange"
                      label="Position"
                      id="position"
                      name="position"
                      value={position}
                      options={positionOptions}
                      onchange={handleInputChange}
                      placeholder="Select Position"
                    >
                    </lightning-combobox>
                  </lightning-layout-item>
                </lightning-layout>
              </div>
  
              <div>
                <lightning-layout style="width: 80%" multiple-rows>
                  <!-- Judicial District combobox -->
                  <lightning-layout-item size="2.5" class="slds-p-right_medium">
                    <lightning-combobox
                      class="SE-notvalidate comboboxItemBackgroundColorChange"
                      label="Judicial District"
                      id="judicialDistrict"
                      name="judicialDistrict"
                      value={judicialDistrict}
                      options={judicialDistrictOptions}
                      onchange={handleInputChange}
                      placeholder="Select Judicial District"
                    >
                    </lightning-combobox>
                  </lightning-layout-item>
  
                  <!-- Indefinite Term checkbox -->
                  <lightning-layout-item
                    size="2.5"
                    class="indefinite-term slds-p-right_medium esq-align"
                  >
                    <lightning-input
                      class="SE-notvalidate"
                      label="Indefinite Term"
                      id="indefiniteTerm"
                      name="indefiniteTerm"
                      type="checkbox"
                      checked={indefiniteTerm}
                      onchange={handleInputChange}
                    >
                    </lightning-input>
                  </lightning-layout-item>
                </lightning-layout>
              </div>
            </div>
  
            <!-- Footer with Clear All and Search buttons -->
            <div class="SE-footer">
              <div class="button-group">
                <div class="clear-all" onclick={handleClear}>
                  <span class="clear-icon-wrapper">
                    <lightning-icon
                      icon-name="utility:close"
                      size="xx-small"
                      class="clear-icon"
                    ></lightning-icon>
                  </span>
                  <span class="clear-text">Clear All</span>
                </div>
                <lightning-button
                  icon-name="utility:search"
                  variant="brand"
                  alternative-text="Search"
                  label="Search"
                  onclick={handleSearch}
                  title="Search"
                  class="customButton"
                >
                </lightning-button>
              </div>
            </div>
          </div>
  
          <!-- Loading spinner while data is being fetched -->
          <template if:true={isLoading}>
            <div class="spinner-container">
              <lightning-spinner
                alternative-text="Loading..."
                variant="brand"
                size="large"
              ></lightning-spinner>
            </div>
          </template>
  
          <!-- Search results section -->
          <template if:false={isLoading}>
            <div class="SE-Card SE-searchCardContent">
              <div class="slds-grid slds-grid_align-end">
                <div class="buttoncontainerfilter">
                  <div class="left-button">
                    <span class="slds-text-title_bold slds-m-right_x-small"
                      >Search Result:</span
                    >
                    <lightning-badge
                      label={recordCountLabel}
                      class="totoalcountbadge"
                    >
                    </lightning-badge>
                  </div>
  
                  <div class="right-buttons">
                    <lightning-badge
                      data-id="today"
                      label="Today"
                      class={badgeClassCurrentDay}
                      onclick={handleBadgeClick}
                    >
                    </lightning-badge>
                    <lightning-badge
                      data-id="this-week"
                      label="This Week"
                      class={badgeClassThisWeek}
                      onclick={handleBadgeClick}
                    >
                    </lightning-badge>
                    <lightning-badge
                      data-id="this-month"
                      label="This Month"
                      class={badgeClassThisMonth}
                      onclick={handleBadgeClick}
                    >
                    </lightning-badge>
                    <lightning-badge
                      data-id="this-quarter"
                      label="This Quarter"
                      class={badgeClassThisQuarter}
                      onclick={handleBadgeClick}
                    >
                    </lightning-badge>
                    <lightning-badge
                      data-id="this-year"
                      label="This Year"
                      class={badgeClassThisYear}
                      onclick={handleBadgeClick}
                    >
                    </lightning-badge>
  
                    <lightning-button
                      label="Add New Official"
                      icon-name="utility:add"
                      onclick={openAddModal}
                      variant="brand"
                      class="customButton"
                    >
                    </lightning-button>
                  </div>
                </div>
              </div>
  
              <!-- Search results table -->
              <template if:true={hasResults}>
                <div
                  class="slds-scrollable_x custom-table-container TrHoverBackGroundColorChange"
                >
                  <table
                    class="slds-table slds-table_cell-buffer slds-table_bordered custom-table"
                  >
                    <thead>
                      <tr class="custom-header">
                        <th
                          scope="col"
                          onclick={sortByField}
                          data-field="lastName"
                        >
                          <div class="slds-truncate" title="LastName">
                            Last Name
                            <lightning-icon
                              icon-name={sortIcon}
                              alternative-text="Sort"
                              size="x-small"
                              class="sort-icon"
                            ></lightning-icon>
                          </div>
                        </th>
                        <th
                          scope="col"
                          onclick={sortByField}
                          data-field="firstName"
                        >
                          <div class="slds-truncate" title="FirstName">
                            First Name
                            <lightning-icon
                              icon-name={sortIcon}
                              alternative-text="Sort"
                              size="x-small"
                              class="sort-icon"
                            ></lightning-icon>
                          </div>
                        </th>
                        <th
                          scope="col"
                          onclick={sortByField}
                          data-field="position"
                        >
                          <div class="slds-truncate" title="Position">
                            Position
                            <lightning-icon
                              icon-name={sortIcon}
                              alternative-text="Sort"
                              size="x-small"
                              class="sort-icon"
                            ></lightning-icon>
                          </div>
                        </th>
                        <th
                          scope="col"
                          onclick={sortByField}
                          data-field="termStart"
                        >
                          <div class="slds-truncate" title="Term Start">
                            Term Start
                            <lightning-icon
                              icon-name={sortIcon}
                              alternative-text="Sort"
                              size="x-small"
                              class="sort-icon"
                            ></lightning-icon>
                          </div>
                        </th>
                        <th
                          scope="col"
                          onclick={sortByField}
                          data-field="termEnd"
                        >
                          <div class="slds-truncate" title="Term End">
                            Term End
                            <lightning-icon
                              icon-name={sortIcon}
                              alternative-text="Sort"
                              size="x-small"
                              class="sort-icon"
                            ></lightning-icon>
                          </div>
                        </th>
                        <th
                          scope="col"
                          onclick={sortByField}
                          data-field="indefiniteTerm"
                        >
                          <div class="slds-truncate" title="Indefinite Term">
                            Indefinite Term
                            <lightning-icon
                              icon-name={sortIcon}
                              alternative-text="Sort"
                              size="x-small"
                              class="sort-icon"
                            ></lightning-icon>
                          </div>
                        </th>
                        <th scope="col">
                          <div class="slds-truncate actionMenu" title="Action">
                            Action
                          </div>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Loading spinner for table rows -->
                      <template if:true={isRecordsLoading}>
                        <tr class="no-border-row">
                          <td
                            colspan="7"
                            class="slds-text-align_center loader-row"
                          >
                            <lightning-spinner
                              alternative-text="Loading records..."
                              variant="brand"
                              size="large"
                            ></lightning-spinner>
                          </td>
                        </tr>
                      </template>
  
                      <!-- Table rows with data -->
                      <template if:false={isRecordsLoading}>
                        <template for:each={paginatedResult} for:item="row">
                          <tr key={row.Id} class="custom-column">
                            <td>
                              <div class="slds-truncate" title={row.LastName}>
                                {row.LastName}
                              </div>
                            </td>
                            <td>
                              <div class="slds-truncate" title={row.FirstName}>
                                {row.FirstName}
                              </div>
                            </td>
                            <td>
                              <div
                                class="slds-truncate"
                                title={row.SAP_Position__c}
                              >
                                {row.SAP_Position__c}
                              </div>
                            </td>
                            <td>
                              <div
                                class="slds-truncate"
                                title={row.SAP_Start_Term__c}
                              >
                                {row.SAP_Start_Term__c}
                              </div>
                            </td>
                            <td>
                              <div
                                class="slds-truncate"
                                title={row.SAP_End_Term__c}
                              >
                                {row.SAP_End_Term__c}
                              </div>
                            </td>
                            <td>
                              <div
                                class="slds-truncate"
                                title={row.SAP_Indefinite_Term__c}
                              >
                                {row.SAP_Indefinite_Term__c}
                              </div>
                            </td>
                            <td>
                              <!-- Action menu for each row -->
                              <lightning-button-menu
                                alternative-text="Actions"
                                class="slds-button_icon slds-button_icon-inverse custom-button-menu"
                                variant="bare"
                                icon-name="utility:threedots_vertical"
                                onselect={handleAction}
                                menu-alignment="auto"
                                data-id={row.Id}
                              >
                                <lightning-menu-item
                                  label="View Official"
                                  variant="base"
                                  value="view_request"
                                ></lightning-menu-item>
                                <lightning-menu-item
                                  label="Edit Official"
                                  variant="base"
                                  value="edit_request"
                                ></lightning-menu-item>
                              </lightning-button-menu>
                            </td>
                          </tr>
                        </template>
                      </template>
                    </tbody>
                  </table>
                </div>
  
                <!-- Pagination controls -->
                <template if:true={showPages}>
                  <div class="pagination-container">
                    <lightning-button
                      class="pagination-button"
                      label="<< Prev"
                      onclick={handlePreviousPage}
                      disabled={isPreviousDisabled}
                      variant="neutral"
                    >
                    </lightning-button>
  
                    <div class="page-info">
                      <span class="page-range"
                        >{startRecord}-{endRecord} of {totalRecords} &nbsp;</span
                      >
                      <span class="page-text">
                        | Page &nbsp;
                        <lightning-input
                          type="number"
                          value={currentPage}
                          label="Current Page"
                          variant="label-hidden"
                          class="current-page-input"
                          onchange={handlePageChange}
                        >
                        </lightning-input>
                        &nbsp; of {totalPages}
                      </span>
                    </div>
  
                    <lightning-button
                      class="pagination-button"
                      label="Next >>"
                      onclick={handleNextPage}
                      disabled={isNextDisabled}
                      variant="neutral"
                    >
                    </lightning-button>
                  </div>
                </template>
              </template>
  
              <!-- No data message -->
              <template if:false={hasResults}>
                <p class="no-data-message">
                  No requests found for the given criteria.
                </p>
              </template>
            </div>
          </template>
        </div>
      </div>
    </lightning-card>
  </template>