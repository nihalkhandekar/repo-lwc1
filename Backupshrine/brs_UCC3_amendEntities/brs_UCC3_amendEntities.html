<!--*********************************************************************************************
 * NAME:  brs_UCC3_amendEntities.html
 * DESCRIPTION:  	brs_UCC3_amendEntities.html
 *                    This LWC component is used for enabling user to create/delete/modify the Lien entities(Debtor,Secured Party, etc)
                      Used in the Brs UCC Amendment flow. 
                      This is a generic component used in multiple screens in salesforce flow. 
 *
 * @AUTHOR: Avinash Shukla
 * @DATE:  12/02/2020       
 *
 *
 * MODIFICATION LOG:
 * DEVELOPER                         DATE                               DESCRIPTION
 * _____________________________________________________________________________________________
* Avinash Shukla	                 12/02/2020                         Created the first version
* Priyanka							 12/09/2020                         Added changes to show/hide back button on popup. 
*********************************************************************************************-->
<template>
    <template if:true={isLoading}>
        <lightning-spinner alternative-text={labels.loading_brs} variant="brand" size="large">
        </lightning-spinner>
    </template>
    <div class="slds-grid slds-wrap">
        <div class="slds-large-size_12-of-12 slds-size_12-of-12 addDebtorBtn">
            <template if:true={amendmentTypeAdd}>
                <button class="slds-button slds-button_natural" onclick={handleAddPopup}>
                    <img src={addIcon} class="addIcon" alt="addIcon" />
                    <span class="addLabel">{addIconLabel}</span>
                </button>
            </template>
        </div>
        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
            <template if:true={amendmentTypeAdd}>
                <template for:each={allMembersInfoFromApexNew} for:item="memberInfo" for:index="index">
                    <div class="slds-large-size_12-of-12 slds-size_12-of-12 debtor-card-details"
                        key={memberInfo.frontEndId}>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <p class="name">{labels.Name}</p>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <template if:true={memberInfo.isIndividual}>
                                <p class="name-member">
                                    {memberInfo.fullName}
                                </p>
                            </template>
                            <template if:true={memberInfo.isOrganisation}>
                                <p class="name-member">{memberInfo.Org_Name__c}</p>
                            </template>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <p class="addressClass small">
                                <img class="slds-m-bottom_xxx-small iconCls" src={locationIcon} alt="address"
                                    aria-hidden="true" />
                                <span>
                                    {memberInfo.fullAddress}
                                </span>
                            </p>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12 card-footer-btns">
                            <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index}
                                data-name={memberInfo.isDuplicate} onclick={editRelatedInfo}>
                                <img src={editIcon} alt="" class="icon" />
                                <span>{labels.Edit_btn}</span>
                            </button>
                            <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index}
                                data-name={memberInfo.isDuplicate} onclick={deleteRelatedInfo}>
                                <img src={deleteIcon} alt="" class="icon" />
                                <span>{labels.Remove}</span>
                            </button>
                        </div>
                    </div>
                </template>
                <div class="slds-col slds-size_12-of-12 separator"></div>
                <template if:true={isSecuredParty}>
                    <p class="a-debtor-desc" if:true={isJudgment}>
                        {labels.Existing_Judgment_Creditors}
                    </p>
                    <p class="a-debtor-desc" if:false={isJudgment}>
                        {labels.Existing_Secured_Party}
                    </p>
                </template>
                <template if:false={isSecuredParty}>
                    <p class="a-debtor-desc" if:true={isJudgment}>
                        {labels.Existing_Judgment_Debtors}
                    </p>
                    <p class="a-debtor-desc" if:false={isJudgment}>
                        {labels.Existing_Debtors}
                    </p>
                </template>

                <template for:each={allMembersInfoFromApexExisting} for:item="memberInfo" for:index="index">
                    <div class="slds-large-size_12-of-12 slds-size_12-of-12 debtor-card-details"
                        key={memberInfo.frontEndId}>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <p class="name">{labels.Name}</p>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <template if:true={memberInfo.isIndividual}>
                                <p class="name-member">
                                    {memberInfo.fullName}
                                </p>
                            </template>
                            <template if:true={memberInfo.isOrganisation}>
                                <p class="name-member">{memberInfo.Org_Name__c}</p>
                            </template>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <p class="addressClass small">
                                <img class="slds-m-bottom_xxx-small iconCls" src={locationIcon} alt="address"
                                    aria-hidden="true" />
                                <span>
                                    {memberInfo.fullAddress}
                                </span>
                            </p>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12 card-footer-btns"
                            if:true={hasEditOrDelete}>
                            <template if:true={amendmentTypeEdit}>
                                <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index}
                                    data-name={memberInfo.isDuplicate} onclick={editRelatedInfo}>
                                    <img src={editIcon} alt="" class="icon" />
                                    <span>{labels.Edit_btn}</span>
                                </button>
                            </template>
                            <template if:true={amendmentTypeDelete}>
                                <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index}
                                    data-name={memberInfo.isDuplicate} onclick={deleteRelatedInfo}>
                                    <img src={deleteIcon} alt="" class="icon" />
                                    <span>{labels.Remove}</span>
                                </button>
                            </template>
                        </div>
                    </div>
                </template>
            </template>
            <template if:false={amendmentTypeAdd}>
                <template for:each={allMembersInfoFromApex} for:item="memberInfo" for:index="index">
                    <div class="slds-large-size_12-of-12 slds-size_12-of-12 debtor-card-details"
                        key={memberInfo.frontEndId}>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <p class="name">{labels.Name}</p>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <template if:true={memberInfo.isIndividual}>
                                <p class="name-member">
                                    {memberInfo.fullName}
                                </p>
                            </template>
                            <template if:true={memberInfo.isOrganisation}>
                                <p class="name-member">{memberInfo.Org_Name__c}</p>
                            </template>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                            <p class="addressClass small">
                                <img class="slds-m-bottom_xxx-small iconCls" src={locationIcon} alt="address"
                                    aria-hidden="true" />
                                <span>
                                    {memberInfo.fullAddress}
                                </span>
                            </p>
                        </div>
                        <div class="slds-large-size_12-of-12 slds-size_12-of-12 card-footer-btns"
                            if:true={hasEditOrDelete}>
                            <template if:true={amendmentTypeEdit}>
                                <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index}
                                    data-name={memberInfo.isDuplicate} onclick={editRelatedInfo}>
                                    <img src={editIcon} alt="" class="icon" />
                                    <span>{labels.Edit_btn}</span>
                                </button>
                            </template>
                            <template if:true={amendmentTypeDelete}>
                                <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index}
                                    data-name={memberInfo.isDuplicate} onclick={deleteRelatedInfo}>
                                    <img src={deleteIcon} alt="" class="icon" />
                                    <span>{labels.Remove}</span>
                                </button>
                            </template>
                        </div>
                    </div>
                </template>
            </template>

        </div>
        <p class="error-text" if:true={showErrorMessage}>
            {errorMessageStr}
        </p>
    </div>
    <c-brs_next-back-buttons show-summary={showGoToSummaryButton} gotosummarylabel={labels.go_to_summary}
        nextlabel={nextLabel} onhandlenext={validAmendment} ongotosummary={handleGoToSummary} hide-back>
    </c-brs_next-back-buttons>
    <!-- 
    Change(s)/Modification(s) for TICKET/STORY/BUG FIX: BRS-1183
    Change(s)/Modification(s) Description : Adding prompt when deleting a secured party/ debtor entity.
    Change(s)/Modification(s) Made on : 2021-01-04
    Change(s)/Modification(s) Made by : Avinash Shukla
    -->
    <template if:true={showPrompt}>
        <section role="dialog" tabindex="-1" aria-label="Meaningful description of the modal content" aria-modal="true"
            aria-describedby="modal-content-id-3" class="remove-modal slds-modal slds-fade-in-open page-scroll-popup">
            <div class="slds-modal__container">
                <header class="slds-modal__header no-border">
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12 modelHeader">
                            <p class="title">
                                {promptMessageTitle}
                            </p>
                            <p>
                                {promptMessageHelpText}
                            </p>
                        </div>
                        <div class="slds-col slds-large-size_1-of-12 slds-size_1-of-12">
                            <label class="closePopup slds-float_right" onclick={handleCancel} tabindex="0" role="button"
                            aria-label={labels.modal_close} onkeypress={showOrHidePromptKeyPress}>
                                <img src={closeIcon} class="closeIcon" alt="" />
                            </label>
                        </div>
                    </div>
                </header>
                <div class="slds-modal__content slds-p-around_medium popup-body" id="modal-content-id-4">
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-size_12-of-12 desc">
                            <div class="slds-large-size_12-of-12 slds-size_12-of-12 debtor-card-details"
                                key={memberInfo.Id}>
                                <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                                    <p class="name">{labels.Name}</p>
                                </div>
                                <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                                    <template if:true={recordToDelete.isIndividual}>
                                        <p class="name-member">
                                            <!-- Adding Bug Fixes for BRS-1040 -->
                                            {recordToDelete.fullName}
                                        </p>
                                    </template>
                                    <template if:true={recordToDelete.isOrganisation}>
                                        <p class="name-member">{recordToDelete.Org_Name__c}</p>
                                    </template>
                                </div>
                                <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                                    <p class="addressClass small">
                                        <img class="slds-m-bottom_xxx-small iconCls" src={locationIcon} alt="address"
                                            aria-hidden="true" />
                                        <!-- Adding Bug Fixes for BRS-1040 -->
                                        <span>{recordToDelete.fullAddress}</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <footer class="slds-modal__footer">
                    <div class="slds-grid slds-wrap modal-footer-section">
                        <div class="slds-col slds-order_2">
                            <button title={OkLabel} onclick={confirmAccept}
                                class="slds-button primaryBtn higher slds-button_brand">
                                {OkLabel}
                            </button>
                        </div>
                        <div class="slds-col slds-order_1">
                            <button title={cancelLabel} onclick={handleCancel}
                                class="slds-button slds-button_natural slds-float_left back-btn">
                                {cancelLabel}
                            </button>
                        </div>
                    </div>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    <!--Change(s)/Modification(s) for TICKET/STORY/BUG FIX: BRS-1183 ENDS HERE -->
    <template if:true={addMemberPopup}>
        <section role="dialog" tabindex="-1" aria-label="dialog" aria-labelledby="" aria-modal="true"
            aria-describedby="modal-content-id-1"
            class="slds-modal slds-fade-in-open slds-modal_small member-popup page-scroll-popup">
            <div class="slds-modal__container">
                <template if:true={showFirstScreen}>
                    <header class="slds-modal__header no-border">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12 modelHeader">
                                <p class="header-text" id="modal-heading-02">
                                    {selectedWayToAmend}&nbsp;a&nbsp;{memberType}
                                </p>
                            </div>
                            <div class="slds-col slds-large-size_1-of-12 slds-size_1-of-12">
                                <label class="closePopup slds-float_right" onclick={closePopUp} tabindex="0" role="button"
                                aria-label={labels.modal_close} onkeypress={handlePopupClose}>
                                    <img src={closeIcon} class="closeIcon" alt="" />
                                </label>
                            </div>
                        </div>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12">
                                <!--Fixes for BRS-1165 UI Issues-->
                                <template if:true={isSecuredParty}>
                                    <p class="a-debtor-desc" if:true={isJudgment}>
                                        {labels.You_can_add_one_or_more} {labels.judgment_Creditor_Plural}
                                        {labels.to_the_lien}
                                    </p>
                                    <p class="a-debtor-desc" if:false={isJudgment}>
                                        {labels.You_can_add_one_or_more} {memberType} {labels.to_the_lien}
                                    </p>
                                </template>
                                <template if:false={isSecuredParty}>
                                    <p class="a-debtor-desc" if:true={isJudgment}>
                                        {labels.You_can_add_one_or_more} {labels.judgment_Debtor_Plural}
                                        {labels.to_the_lien}
                                    </p>
                                    <p class="a-debtor-desc" if:false={isJudgment}>
                                        {labels.You_can_add_one_or_more} {memberType}
                                        {labels.to_the_lien}
                                    </p>
                                </template>
                                <!--Fixes for BRS-1165 UI Issues-->
                            </div>
                        </div>
                    </header>
                    <!-- Modal/Popup Box LWC body starts here -->
                    <div class="slds-modal__content slds-p-around_medium popup-body radio-options"
                        id="modal-content-id-1">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-size_12-of-12">
                                <p class="agent-mailing-address radio-heading">
                                    {labels.is_the} {memberType} {labels.an_organization_or_an_individual}
                                </p>
                                <c-generic-radio_brs name="amend-options" radio-options={memberOptions}
                                    onctbosdatachange={handleOptions} answer={selectedTypeOption}
                                    has-error={typeIsNotSelected}></c-generic-radio_brs>
                                <template if:true={typeIsNotSelected}>
                                    <div class="slds-text-color_destructive">
                                        {labels.UCC_Flow_Select_Lien} {memberType} {labels.UCC_Flow_Select_Lien_Type}
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    <!-- Modal/Popup Box LWC footer starts here -->
                    <footer class="slds-modal__footer">
                        <button class="slds-button_stretch higher primaryBtn slds-button slds-button_brand"
                            onclick={goToSecondScreen}>
                            {nextLabel}
                            <img src={chevronRightWhite} class="rightIcon" alt="rightIcon" />
                        </button>
                    </footer>
                </template>
                <template if:true={addDetails}>
                    <header class="slds-modal__header no-border">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12 modelHeader">
                                <template if:false={amendmentTypeEdit}>
                                    <p class="header-text" id="modal-heading-03">
                                        {selectedWayToAmend} {labels.An_Label} {type} {labels.As_Label} {labels.brs_a} {memberType}
                                    </p>
                                </template>
                                <template if:true={amendmentTypeEdit}>
                                    <p class="header-text" id="modal-heading-04">
                                        <template if:true={showAddOrganizationDetails}>
                                            {labels.Changing_New} {memberInfo.Org_Name__c}
                                        </template>
                                        <template if:false={showAddOrganizationDetails}>
                                            {labels.Changing_New} {memberInfo.fullName}
                                        </template>
                                    </p>
                                </template>
                            </div>
                            <div class="slds-col slds-large-size_1-of-12 slds-size_1-of-12">
                                <label class="closePopup slds-float_right" onclick={closePopUp} tabindex="0" role="button"
                                aria-label={labels.modal_close} onkeypress={handlePopupClose}>
                                    <img src={closeIcon} class="closeIcon" alt="" />
                                </label>
                            </div>
                        </div>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12">
                                <!--Fixes for BRS-1165 UI Issues-->
                                <template if:true={amendmentTypeAdd}>
                                    <template if:true={isSecuredParty}>
                                        <p class="a-debtor-desc" if:true={isJudgment}>
                                            {labels.You_can_add_one_or_more} {labels.judgment_Creditor_Plural}
                                            {labels.to_the_lien}
                                        </p>
                                        <p class="a-debtor-desc" if:false={isJudgment}>
                                            {labels.You_can_add_one_or_more} {memberType} {labels.to_the_lien}
                                        </p>
                                    </template>
                                    <template if:false={isSecuredParty}>
                                        <p class="a-debtor-desc" if:true={isJudgment}>
                                            {labels.You_can_add_one_or_more} {labels.judgment_Debtor_Plural}
                                            {labels.to_the_lien}
                                        </p>
                                        <p class="a-debtor-desc" if:false={isJudgment}>
                                            {labels.You_can_add_one_or_more} {memberType}
                                            {labels.to_the_lien}
                                        </p>
                                    </template>
                                </template>
                                <!--Fixes for BRS-1165 UI Issues-->
                            </div>
                        </div>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium popup-body radio-options"
                        id="modal-content-id-2">
                        <!-- Modal/Popup Box LWC body starts here [Organisation Modal]-->
                        <!--Render this template when the selection is of type Organisaiton-->
                        <template if:true={showAddOrganizationDetails}>
                            <p class="agent-mailing-address">{type} {labels.Information}</p>
                            <div class="slds-grid slds-gutters slds-wrap form-row orgName">
                                <div class="slds-col slds-size_1-of-1 slds-large-size_4-of-12 formCol inputForm">
                                    <!--Fixes for BRS-1165 UI Issues-->
                                    <lightning-input label={labels.organizations_name} type="text" data-id="Org_Name__c"
                                        value={memberInfo.Org_Name__c} max-length="255" required
                                        message-when-value-missing={labels.NameMandatory} onchange={onInputChange} onblur={onInputBlur}>
                                    </lightning-input>
                                </div>
                            </div>
                            <p class="agent-mailing-address orgLocation address-header">{labels.location}</p>
                            <div class="orgAddress">
                                <c-brs_address address-type={labels.organizations} can-be-outside-us source={source} class="mailingAddressOrganisation"
                                    unitlabel="Unit/Apt" autocomplete set-retained-address={businessAddressFields}
                                    onaddresschange={addressChanged} accept-po>
                                </c-brs_address>
                            </div>
                        </template>
                        <!-- Modal/Popup Box LWC body starts here [Organisation Modal]-->
                        <template if:true={showAddIndividualDetails}>
                            <p class="agent-mailing-address">{type}'s {labels.Name}</p>
                            <div class="slds-grid slds-wrap individualDetails">
                                <div class="c-container">
                                    <div class="slds-grid slds-gutters slds-wrap form-row">
                                        <div
                                            class="slds-col slds-size_1-of-1 slds-large-size_3-of-12 formCol inputForm">
                                            <lightning-input type="text" label={labels.surNameLabel}
                                                data-id="Individual_SurName__c" maxlength="80" required
                                                message-when-value-missing={labels.Surname_is_mandatory}
                                                value={memberInfo.Individual_SurName__c} onchange={onInputChange} onblur={onInputBlur}>
                                            </lightning-input>
                                        </div>
                                        <div
                                            class="slds-col slds-size_1-of-1 slds-large-size_3-of-12 formCol inputForm">
                                            <lightning-input type="text" label={labels.firstNameLabel}
                                                data-id="Individual_First_Name__c" maxlength="80"
                                                value={memberInfo.Individual_First_Name__c} onchange={onInputChange} onblur={onInputBlur}>
                                            </lightning-input>
                                        </div>
                                        <div
                                            class="slds-col slds-size_1-of-1 slds-large-size_3-of-12 formCol inputForm">
                                            <lightning-input type="text" label={labels.middleNameLabel}
                                                data-id="Individual_Middle_Name__c" maxlength="80"
                                                value={memberInfo.Individual_Middle_Name__c} onchange={onInputChange} onblur={onInputBlur}>
                                            </lightning-input>
                                        </div>
                                        <div
                                            class="slds-col slds-size_1-of-1 slds-large-size_3-of-12 formCol inputForm">
                                            <lightning-input type="text" label={labels.suffixLabel} data-id="Suffix__c"
                                                maxlength="80" value={memberInfo.Suffix__c} onchange={onInputChange} onblur={onInputBlur}>
                                            </lightning-input>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p class="agent-mailing-address address-header">{labels.location}</p>
                            <div class="individualDetails">
                                <c-brs_address address-type={labels.mailing} can-be-outside-us source={source} class="mailingAddressIndividual"
                                    unitlabel="Unit/Apt" autocomplete set-retained-address={businessAddressFields}
                                    onaddresschange={addressChanged} accept-po>
                                </c-brs_address>
                            </div>
                        </template>
                        <!-- Modal/Popup Box LWC footer starts here -->
                    </div>
                    <footer class="slds-modal__footer">
                        <div class="slds-grid slds-wrap modal-footer-section">
                            <div class="slds-col slds-order_2">
                                <button class="slds-button primaryBtn higher slds-button_brand" onclick={handleConfirm}
                                    disabled={disableConfirmButton}>
                                    {confirmLabel}
                                </button>
                            </div>
                            <div class="slds-col slds-order_1">
                                <template if:true={showBack}>
                                    <button class="slds-button slds-button_natural slds-float_left back-btn"
                                        onclick={handleBack}>{prevLabel}</button>
                                </template>
                            </div>
                        </div>
                    </footer>
                </template>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>