<template>
    <div class="dashboard-container">
        <template if:true={isLoading}>
            <div class="spinner-container">
                <lightning-spinner alternative-text="Loading..." variant="brand" size="large"></lightning-spinner>
            </div>
        </template>
        <template if:false={isLoading}>
            <!-- Breadcrumb Navigation -->
            <div class="breadcrumb-container">
                <div class="breadcrumb">
                    <a href="#" onclick={navigateToDashboard}>{labels.MyDashboard}</a>
                    <lightning-icon
                        class="chevron-icon custom-color slds-icon_x-small"
                        icon-name="utility:chevronright"
                        size="x-small"
                        alternative-text="Chevron Right"
                    ></lightning-icon>
                    <div class="subtextbox">
                        <span>{labels.CancelledOrders}</span>
                    </div>
                </div>
            </div>

            <!-- Submitted Requests Card -->
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-icon">
                            <lightning-icon icon-name="action:reject" size="medium" class="dashboard-icon"></lightning-icon>
                        </div>
                        <div class="card-content">
                            <h2 class="card-title">{labels.CancelledOrders}</h2>
                            <p class="card-description">{labels.ViewCancelledOrders}</p>
                        </div>
                    </div>
                </div>
                <template if:true={paginatedResult}>
                    <div class="slds-scrollable_x custom-table-container">
                        <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered custom-table">
                            <thead>
                                <tr class="custom-header">
                                    <th scope="col" style="width: 200px; min-width: 200px;" onclick={sortByField} data-field="ApplicationID">
                                        <div class="slds-truncate" title="Work Order">
                                             {labels.WorkOrder_}
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="AppliedDate">
                                        <div class="slds-truncate" title="Created Date">
                                            {labels.WorkDate}
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="requestorName">
                                        <div class="slds-truncate" title="Requester Name">
                                            {labels.RequestorName}<lightning-icon
                                                icon-name={sortIcon}
                                                alternative-text="Sort"
                                                size="x-small"
                                                class="sort-icon"
                                            ></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="ApplicationID">
                                        <div class="slds-truncate" title="Document Type">
                                            {labels.ItemDescription}
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="CancellationType">
                                        <div class="slds-truncate" title="Cancellation Type">
                                           {labels.CancellationType}
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="ReasonForCancellation">
                                        <div class="slds-truncate" title="Reason For Cancellation">
                                            {labels.ReasonForCancellation}
                                            <!-- <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon> -->
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="CancellationDate">
                                        <div class="slds-truncate" title="Cancellation Date">
                                            {labels.CancellationDate}
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;">
                                        <div class="slds-truncate" title="Action">{labels.Action}</div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <template if:true={isRecordsLoading}>
                                    <tr class="no-border-row">
                                        <td colspan="8" class="slds-text-align_center loader-row">
                                            <lightning-spinner alternative-text="Loading records..." variant="brand" size="large"></lightning-spinner>
                                        </td>
                                    </tr>
                                </template>
                                <template if:false={isRecordsLoading}>
                                    <template for:each={paginatedResult} for:item="row">
                                    <tr key={row.Id} class="custom-column classForTbodyOfDraftRequest">
                                        <td>
                                            <div class="slds-truncate" title={row.ApplicationID}>
                                                <template if:true={row.hasDocuments}
                                                class="slds-button slds-button_icon slds-m-right_x-small"
                                                aria-expanded={row.isExpanded}
                                                aria-controls="documents-{row.Id}">
                                                <span
                                                    class="slds-icon_container slds-icon-border-filled icon-border">
                                                    <lightning-icon class={iconClass} data-id={row.Id} onclick={toggleDocument} icon-name={row.iconName} size="xx-small"
                                                        alternative-text="Toggle"></lightning-icon>
                                                </span>
                                            </template>
                                            <template if:true={row.hasDocuments}>
                                                <a href="javascript:void(0);" 
                                                   onclick={navigateToTrack} 
                                                   data-application-id={row.ApplicationID} 
                                                   class="tableText">
                                                    {row.ApplicationID}
                                                </a>
                                                <template if:false={row.isExpanded}>
                                                    <span class="doc-count">+{row.docCount}</span>
                                                </template>
                                            </template>
                                            <template if:false={row.hasDocuments}>
                                                <a href="javascript:void(0);" 
                                                   onclick={navigateToTrack} 
                                                   data-application-id={row.ApplicationID} 
                                                   class="tableTextChild">
                                                    {row.ApplicationID}
                                                </a>
                                            </template>
                                            
                                            </div>
                                        </td>
                                        <td class="column2">
                                            <div class="slds-truncate" title={row.AppliedDate}>{row.AppliedDate}</div>
                                        </td>
                                        <td class="column3">
                                            <div class="slds-truncate" title={row.requestorName}>{row.requestorName}</div>
                                        </td>
                                        <td class="column4">
                                            <div class="slds-truncate" title={row.documentType}>{row.documentType}</div>
                                        </td>
                                        <td class="column5">
                                            <div class="slds-truncate cancellationType" title={row.CancellationType}>{row.CancellationType}</div>
                                        </td>
                                        <td class="column6">
                                            <div class="slds-truncate" title={row.ReasonForCancellation}>{row.ReasonForCancellation}</div>
                                        </td>
                                        <td class="column7">
                                            <div class="slds-truncate" title={row.CancellationDate}>{row.CancellationDate}</div>
                                        </td>
                                        <td class="column9">
                                            <a href="javascript:void(0)" class="actionView" onclick={handleViewAction} data-id={row.Id}>{labels.ReinstateOrder}</a>
                                        </td>
                                    </tr>
                                    <template if:true={row.isExpanded}>
                                        <template for:each={row.documents} for:item="document">
                                            <tr key={document.Id} class="custom-column-child">
                                                <td class="column1">
                                                    <div class="slds-truncate tableTextChild" title={row.ApplicationID}>
                                                        {row.ApplicationID}
                                                    </div>
                                                </td>
                                                <td  class="column2">
                                                    <div class="slds-truncate" title={row.AppliedDate}>
                                                        {row.AppliedDate}
                                                    </div>
                                                </td>
                                                <td  class="column3">
                                                    <div class="slds-truncate" title={document.requestorName}>
                                                        {row.requestorName}
                                                    </div>
                                                </td>
                                                <td  class="column4">
                                                    <div class="slds-truncate" title={document.documentType}>
                                                        {document.documentType}
                                                    </div>
                                                </td>
                                                <td  class="column5">
                                                    <div class="slds-truncate cancellationType"
                                                        title={row.CancellationType}>
                                                        {row.CancellationType}
                                                    </div>
                                                </td>
                                                <td class="column6">
                                                    <div class="slds-truncate" title={row.ReasonForCancellation}>
                                                        {row.ReasonForCancellation}</div>
                                                </td>
                                                <td  class="column7">
                                                    <div class="slds-truncate" title={row.CancellationDate}>
                                                        {row.CancellationDate}</div>
                                                </td>
                                                <td class="column9">
                                                    <a href="javascript:void(0)" class="actionView" onclick={handleViewAction} data-id={row.Id}>{labels.ReinstateOrder}</a>
                                                </td>
                                            </tr>
                                        </template>
                                    </template>
                                </template>
                            </template>
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination controls -->
                    <template if:true={showPages}>
                        <div class="pagination-controls">
                            <lightning-button
                                label={labels.Prev}
                                icon-name="utility:jump_to_left"
                                icon-position="left"
                                onclick={handlePreviousPage}
                                variant="neutral"
                                disabled={isPreviousDisabled}
                            ></lightning-button>
                            <span class="paginationText">{startRecord} - {endRecord} of {totalRecords} | Page {currentPage} of {totalPages}</span>
                            <lightning-button
                                label={labels.Next}
                                icon-name="utility:jump_to_right"
                                icon-position="right"
                                onclick={handleNextPage}
                                variant="neutral"
                                disabled={isNextDisabled}
                            ></lightning-button>
                        </div>
                    </template>
                </template>
                <template if:false={paginatedResult}>
                    <p class="no-data-message">{labels.Youhavenocancelledrequests}</p>
                </template>
            </div>

            <!-- Reinstate Order Modal -->
            <template if:true={reinstateOrder}>
                <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open custom-modal">
                    <div class="slds-modal__container custom-modal-container">
                        <header class="slds-modal__header header-content popupheader">
                            <span class="header-label">{labels.ReinstateWorkOrderNumber} {selectedWorkOrder}</span>
                            <lightning-icon class="close-icon" icon-name="utility:close" size="small" onclick={handleCancel}></lightning-icon>
                        </header>
                        <div class="slds-modal__content slds-p-around_large body-content">
                            <p class="slds-m-top_x-small body-matter">
                               {labels.Areyousureyouwanttoreinstateyourorder}
                            </p>
                        </div>
                        <footer class="slds-modal__footer footer-content popupfooter">
                            <button class="no-button" onclick={handleCancel}>{labels.No}</button>
                            <button class="yes-button" onclick={handleYesOfReinstateRequest}>{labels.Yes}</button>
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>
        </template>
    </div>
</template>