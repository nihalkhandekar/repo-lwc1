<template>
    <template if:true={isLoading}>
        <lightning-spinner alternative-text={label.loading_brs} variant="brand" size="large">
        </lightning-spinner>
    </template>
    <c-brs_header heading-text={entityTitleMsg} description-text={typedescription} theme="theme1"></c-brs_header>
    <div class="slds-grid slds-wrap">
        <div class="slds-large-size_12-of-12 slds-size_12-of-12 addDebtorBtn">
            <button class="slds-button slds-button_natural" onclick={handleAddPopup}>
                <img src={addIcon} class="addIcon" alt="addIcon" />
                <span class="addLabel">{debtorName}</span>
            </button>
        </div>
        <template for:each={allMembersInfoFromApex} for:item="memberInfo" for:index="index">
            <div class="slds-grid slds-wrap debtor-card-details" key={memberInfo.uccAssignor.frontEndId}>
                <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                    <p class="name">{feMemberType}
                        <template if:true={memberInfo.isDuplicate}>
                            <span
                                class="slds-badge slds-theme_warning statusText">{labels.Duplicate}</span>
                        </template>
                    </p>
                </div>
                <div class="slds-large-size_5-of-12 slds-size_12-of-12">
                    <template if:true={memberInfo.uccAssignor.isIndividual}>
                        <p class="name-member">{memberInfo.uccAssignor.fullName}</p>
                    </template>
                    <template if:true={memberInfo.uccAssignor.isOrganisation}>
                        <p class="name-member">{memberInfo.uccAssignor.Org_Name__c}</p>
                    </template>
                    <p class="addressClass">
                        <img class="slds-m-bottom_xxx-small iconCls" src={locationIcon} alt="address"
                            aria-hidden="true" />
                        <span>{memberInfo.uccAssignor.fullAddress}</span>
                    </p>
                </div>
                <div class="slds-large-size_2-of-12 slds-size_12-of-12">
                </div>
                <div class="slds-large-size_5-of-12 slds-size_12-of-12">
                    <div class="addressAssignee">
                        <b if:true={isAssignee}>{labels.BRS_UCC_Assignor_Label} : </b>
                        <b if:false={isAssignee}>{labels.Assignee_Label} : </b>
                        <template for:each={memberInfo.uccAssignees} for:item="assignee">
                            <p key={assignee.frontEndId} class="field-name small">
                                <template if:true={assignee.isIndividual}>
                                    {assignee.fullName}
                                </template>
                                <template if:true={assignee.isOrganisation}>
                                    {assignee.Org_Name__c}
                                </template>
                            </p>
                        </template>

                    </div>
                </div>

                <div class="slds-large-size_12-of-12 slds-size_12-of-12 card-footer-btns">
                    <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index} data-name={memberInfo.isDuplicate} onclick={editRelatedInfo}>
                        <img src={editIcon} alt="" class="icon" />
                        <span>{labels.Edit_btn}</span>
                    </button>
                    <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index} data-name={memberInfo.isDuplicate}
                        onclick={onDuplicate}>
                        <img src={duplicate} alt="" class="icon" />
                        <span>{labels.Duplicate}</span>
                    </button>
                    <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index}
                        onclick={deleteRelatedInfo} if:false={memberInfo.isDuplicate}>
                        <img src={deleteIcon} alt="" class="icon" />
                        <span>{labels.Remove}</span>
                    </button>
                    <button class="natural-button-with-icon slds-button slds-button_natural" data-id={index} data-name={memberInfo.isDuplicate}
                        onclick={deleteRelatedInfo} data-fid={memberInfo.frontEndId} if:true={memberInfo.isDuplicate}>
                        <img src={deleteIcon} alt="" class="icon" role="presentation"/>
                        <span>{labels.Remove}</span>
                    </button>
                </div>
            </div>
        </template>

        <p class="error-text" if:true={showErrorMessage}>
            {errorMessageStr}
        </p>

        <div class="slds-large-size_12-of-12 slds-size_12-of-12">
            <c-brs_next-back-buttons nextlabel={labels.Next} prevlabel={prevLabel} onhandlenext={validate}
                show-summary={showGoToSummaryButton} gotosummarylabel={labels.go_to_summary} ongotosummary={handleGoToSummary}
                onhandleback={handlePropagateBack}></c-brs_next-back-buttons>
        </div>

    </div>
    <!--Radio pop up to choose Individual or Organization-->
    <template if:true={addMemberPopup}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1"
            class="slds-modal slds-fade-in-open slds-modal_small brs-ucc-popup member-popup add-member-popup page-scroll-popup">
            <div class="slds-modal__container">
                <template if:true={showFirstScreen}>
                    <header class="slds-modal__header no-border">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12 modelHeader">
                                <p class="header-text" id="modal-heading-02">{labels.Add_an} {feMemberType}</p>
                            </div>
                            <div class="slds-col slds-large-size_1-of-12 slds-size_1-of-12">
                                <label class="closePopup slds-float_right" onclick={closePopUp}>
                                    <img src={closeIcon} class="closeIcon" alt="closeIcon" />
                                </label>
                            </div>
                        </div>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12">
                                <template if:false={showLastScreen}>
                                    <p class="a-debtor-desc">{labels.You_can_add_one_or_more} {feMemberType}s
                                        {labels.to_the_lien}
                                    </p>
                                </template>
                                <template if:true={showLastScreen}>
                                    <p class="a-debtor-desc">{labels.You_can_add_one_or_more} {relatedMemberTypeforUI}s
                                        {labels.to_the_lien}
                                    </p>
                                </template>
                            </div>
                        </div>
                    </header>
                    <!-- Modal/Popup Box LWC body starts here -->
                    <div class="slds-modal__content slds-p-around_medium popup-body radio-options"
                        id="modal-content-id-1">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-size_12-of-12">
                                <p class="a-debtor-desc largeBold radio-heading">{labels.is_the} {feMemberType}
                                    {labels.an_organization_or_an_individual}</p>
                                <c-generic-radio_brs name="assignor-options" radio-options={memberOptions}
                                    has-error={typeIsNotSelected} onctbosdatachange={handleOptions}
                                    answer={selectedTypeOption}></c-generic-radio_brs>
                                <template if:true={typeIsNotSelected}>
                                    <div class="error-text">{labels.UCC_Flow_Select_Lien} {feMemberType}
                                        {labels.UCC_Flow_Select_Lien_Type}</div>
                                </template>
                            </div>
                        </div>
                    </div>
                    <!-- Modal/Popup Box LWC footer starts here -->
                    <footer class="slds-modal__footer">
                        <button class="slds-button_stretch  primaryBtn slds-button slds-button_brand higher"
                            onclick={goToSecondScreen}>{labels.Next}
                            <img src={chevronRightWhite} class="rightIcon" alt="rightIcon" />
                        </button>
                    </footer>
                </template>
                <template if:true={addDetails}>
                    <header class="slds-modal__header no-border">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12 modelHeader">
                                <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12 modelHeader">
                                    <template if:false={showLastScreen}>
                                        <p class="header-text" id="modal-heading-03">
                                            {labels.Add_an} {type} {labels.as_an_label} {feMemberType}
                                        </p>
                                    </template>
                                    <template if:true={showLastScreen}>
                                        <p class="header-text" id="modal-heading-04">
                                            <template if:true={isAssignee}>
                                            {labels.Select_Assignors}
                                        </template>
                                        <template if:false={isAssignee}>
                                            {labels.select_an_assignee}
                                        </template>
                                        </p>
                                    </template>

                                </div>
                            </div>
                            <div class="slds-col slds-large-size_1-of-12 slds-size_1-of-12">


                                <label class="closePopup slds-float_right" onclick={closePopUp}>
                                    <img src={closeIcon} class="closeIcon" alt="closeIcon" />
                                </label>
                            </div>
                        </div>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-large-size_11-of-12 slds-size_11-of-12">
                                <template if:false={showLastScreen}>
                                    <p class="a-debtor-desc">{labels.You_can_add_one_or_more} {feMemberType}s
                                        {labels.to_the_lien}
                                    </p>
                                </template>
                                <template if:true={showLastScreen}>

                                    <p class="a-debtor-desc" if:true={isAssignee}>
                                        {labels.select_Secured_Party_As_Assignee}
                                    </p>
                                    <p class="a-debtor-desc" if:false={isAssignee}>{labels.Select_SecuredParty}
                                    </p>
                                </template>
                            </div>
                        </div>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium popup-body radio-options"
                        id="modal-content-id-2">
                        <template if:true={showAddOrganizationDetails}>
                            <p class="agent-mailing-address">{labels.organizations} {labels.Information}</p>
                            <div class="slds-grid slds-wrap orgName">
                                <div class="inputForm">
                                    <lightning-input label={labels.organizations_name} type="text" data-id="Org_Name__c"
                                        value={memberInfo.Org_Name__c} max-length="75" required
                                        onchange={onInputChange}>
                                    </lightning-input>
                                </div>
                            </div>
                            <p class="agent-mailing-address orgLocation">{labels.location}</p>
                            <div class="orgAddress">
                                <c-brs_address address-type={labels.organizations} can-be-outside-us source={source}
                                    class="mailingAddressOrganisation" unitlabel={label.AddressUnit_Apt} autocomplete
                                    set-retained-address={businessAddressFields} accept-po>
                                </c-brs_address>
                            </div>
                        </template>
                        <!-- Modal/Popup Box LWC body starts here [Organisation Modal]-->
                        <template if:true={showAddIndividualDetails}>
                            <div if:true={addIndividualDetails}>
                                <p class="agent-mailing-address">{labels.individuals} {labels.Name}</p>
                                <div class="slds-grid slds-wrap individualDetails">
                                    <div class="c-container">
                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col inputForm">
                                                <lightning-input type="text" label={labels.surNameLabel}
                                                    data-id="Individual_SurName__c" maxlength="80" required
                                                    message-when-value-missing={labels.Surname_is_mandatory}
                                                    value={memberInfo.Individual_SurName__c} onchange={onInputChange}>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col inputForm">
                                                <lightning-input type="text" label={labels.firstNameLabel}
                                                    data-id="Individual_First_Name__c" maxlength="80"
                                                    value={memberInfo.Individual_First_Name__c}
                                                    onchange={onInputChange}>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col inputForm">
                                                <lightning-input type="text" label={labels.middleNameLabel}
                                                    data-id="Individual_Middle_Name__c" maxlength="80"
                                                    value={memberInfo.Individual_Middle_Name__c}
                                                    onchange={onInputChange}>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col inputForm">
                                                <lightning-input type="text" label={labels.suffixLabel}
                                                    data-id="Suffix__c" maxlength="80" value={memberInfo.Suffix__c}
                                                    onchange={onInputChange}>
                                                </lightning-input>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p class="agent-mailing-address">{labels.individuals} {labels.Label_Address}</p>
                                <div class="individualDetails">
                                    <c-brs_address address-type={labels.mailing} can-be-outside-us source={source}
                                        class="mailingAddressIndividual" unitlabel={label.AddressUnit_Apt} autocomplete
                                        set-retained-address={businessAddressFields}
                                        accept-po></c-brs_address>
                                </div>
                            </div>
                        </template>
                        <template if:true={addSelectedAssignors}>
                            <p class="agent-mailing-address assignor-details" if:true={isAssignee}>{labels.secured_party_Assignor}
                            </p>
                            <p class="agent-mailing-address assignor-details" if:false={isAssignee}>{labels.Secured_Party_Assignee_Question}
                            </p>
                            
                            <template if:true={hasSecuredParties}>
                                <template for:each={allSecuredPartiesfromApex} for:item="sParty" for:index="index">
                                    <div class="ct-bos-multi-container-all assignorCards" key={sParty.Id}>

                                        <div class="tabfocus" tabindex="0">
                                            <div
                                                class="ct-bos-multi-checkbox-container ct-bos-multi-container-individual">
                                                <div class="slds-grid">
                                                    <div class="slds-large-size_12-of-12 slds-size_12-of-12">
                                                        <label class="ct-bos-multi-checkbox-label" tabindex="-1">

                                                            <input class="ct-bos-multi-checkbox-input" type="checkbox"
                                                                data-id={sParty.Id} aria-hidden="true" tabindex="-1"
                                                                onchange={handleCheckbox} checked={sParty.isChecked} />
                                                            <div class="checkbox-wrapper desktopTheme">
                                                                <p class="checkmark-container">
                                                                    <span
                                                                        class="ct-bos-multi-checkbox-custom containerTheme"></span>
                                                                </p>
                                                                <div class="checkbox-label boxShadow">
                                                                    <p class="labelFirstRow">
                                                                        <span
                                                                            class="labelId"><b>{labels.Name}</b></span>
                                                                    </p>
                                                                    <template if:true={sParty.isIndividual}>
                                                                        <p class="name-member">
                                                                            {sParty.dispName}
                                                                        </p>
                                                                    </template>
                                                                    <template if:true={sParty.isOrganisation}>
                                                                        <p class="name-member org-name-member">
                                                                            {sParty.Org_Name__c}</p>
                                                                    </template>
                                                                    <p class="small labelId"><img src={fileimage}
                                                                            class="addressIcon">
                                                                        <span
                                                                            if:false={sParty.International_Address__c}>
                                                                            {sParty.Street__c},
                                                                            {sParty.City__c}, {sParty.State__c},
                                                                            {sParty.Zip_Code__c}, {sParty.Country__c}
                                                                        </span>
                                                                        <span if:true={sParty.International_Address__c}>
                                                                            {sParty.International_Address__c},
                                                                            {sParty.Country__c}
                                                                        </span>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="mobileTheme checkbox-wrapper">
                                                                <div class="radio-wrapper">
                                                                    <div class="checkbox-label boxShadow">
                                                                        <p class="labelFirstRow smallBold grey-text">
                                                                            {labels.Name}</p>
                                                                        <p class="labelcontent">
                                                                            <template if:true={sParty.isIndividual}>
                                                                                <p class="name-member">
                                                                                    {sParty.dispName}
                                                                                </p>
                                                                            </template>
                                                                            <template if:true={sParty.isOrganisation}>
                                                                                <p class="name-member">
                                                                                    {sParty.Org_Name__c}</p>
                                                                            </template>
                                                                        </p>
                                                                        <p class="small labelId"><img src={fileimage}
                                                                                class="addressIcon">
                                                                            <span
                                                                                if:false={sParty.International_Address__c}>
                                                                                {sParty.Street__c},
                                                                                {sParty.City__c}, {sParty.State__c},
                                                                                {sParty.Zip_Code__c},
                                                                                {sParty.Country__c}
                                                                            </span>
                                                                            <span
                                                                                if:true={sParty.International_Address__c}>
                                                                                {sParty.International_Address__c},
                                                                                {sParty.Country__c}
                                                                            </span>
                                                                        </p>
                                                                    </div>
                                                                    <p class="checkmark-container">
                                                                        <span
                                                                            class="ct-bos-multi-checkbox-custom containerTheme"></span>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </template>
                            <p class="error-text" if:true={showAssigneeOrAssignorError}>
                                Please select secured parties.
                            </p>
                        </template>

                        <!-- Modal/Popup Box LWC footer starts here -->
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button primaryBtn slds-button_brand higher" onclick={handleConfirmButton}
                            if:true={addSelectedAssignors}>{labels.Confirm}
                        </button>
                        <button class="slds-button primaryBtn slds-button_brand higher"
                            onclick={nextbuttonforAssignment} if:true={addOginizationDetails}> {labels.Next}
                        </button>
                        <button class="slds-button primaryBtn slds-button_brand higher"
                            onclick={nextbuttonforAssignment} if:true={addIndividualDetails}> {labels.Next}
                        </button>
                        <template if:false={isEditMode}>
                            <button class="slds-button natural-button slds-button_natural back-btn" onclick={handleBack}
                                if:true={addOginizationDetails}>{labels.Back}
                            </button>
                            <button class="slds-button natural-button slds-button_natural back-btn" onclick={handleBack}
                                if:true={addIndividualDetails}>{labels.Back}
                            </button>
                        </template>
                        <button class="slds-button natural-button slds-button_natural back-btn"
                            onclick={goBackPreviousScreen} if:true={addSelectedAssignors}>{labels.Back}
                        </button>
                    </footer>

                </template>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    <template if:true={confirmAddMemberPopup}>
        <c-modal open={confirmAddMemberPopup} onmodalclose={closeConfirmPopup} size={modalSize}>
            <div slot="header" class="headerModal slds-size_1-of-1">
                <h6 class="confirm-header">{labels.BRS_Conf_Assignor}</h6>
            </div>
            <div slot="body" class="slds-m-bottom_large">
                <p class="large">{labels.BRS_Conf_Assignor_Subtext}</p>
                <div class="card-wrapper">
                    <p class="name-title smallGreyBold">
                        {labels.Name}
                    </p>
                    <h6 class="name-main">
                        {confirmName}
                    </h6>
                    <p class="address small grey-text">
                        <img class="slds-m-bottom_xxx-small iconCls" src={locationIcon} alt="address"
                            aria-hidden="true" />{confirmAddress}
                    </p>
                </div>
            </div>
            <div slot="actions" class="slds-m-vertical_small slds-size_1-of-1">
                <div class="buttons-wrapper">
                    <button title={labels.Cancel_Label} onclick={closeConfirmPopup}
                        class="slds-button natural-button slds-button_natural">
                        {labels.Cancel_Label}
                    </button>
                    <button title={labels.Confirm} onclick={handleAddConfirm} class="slds-button primaryBtn higher">
                        {labels.Confirm}
                    </button>
                </div>
            </div>
        </c-modal>
    </template>
</template>