<template>
    <lightning-card>
        <div class="SE-mainBody">
            <div class="SE-content">
                <div class="SE-top">
                    <div class="SE-linkLable">
                        Extradition Requests
                    </div>
                </div>
                <div class="SE-Card firstDivForSearching">
                    <div class="SE-searchCardHeader searchTitleHeader">
                        <div class="SE-searchCardHeaderIcon">
                            <lightning-icon icon-name="standard:search" size="medium"></lightning-icon>
                        </div>
                        <div class="SE-searchCardHeaderTitle">
                            <div class="SE-searchCardHeaderTitleText">
                                Search
                            </div>
                        </div>
                    </div>
                    <div class="SE-searchCardContent">
                        <div class="searchInputFieldsAndComboboxContainer">
                            <lightning-layout>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-searchCardInputLabel" name="lastName" label="Person Sought Last Name" id="LastName"
                                        type="text" value={lastName} pattern="[A-Za-z]+" message-when-pattern-mismatch="Last name should only contain letters." onchange={handleInputChange}
                                        >
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-searchCardInputLabel" name="firstName" label="Person Sought First Name" id="FirstName"
                                        type="text" pattern="[A-Za-z]+" message-when-pattern-mismatch="First name should only contain letters." value={firstName} onchange={handleInputChange}
                                        >
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-searchCardInputLabel" name="akaLastName" label="Person Sought AKA Last Name" id="akaLastName"
                                        type="text" value={akaLastName} pattern="[A-Za-z]+" message-when-pattern-mismatch="Aka last name should only contain letters." onchange={handleInputChange}
                                        >
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-searchCardInputLabel" name="akaFirstName" label="Person Sought AKA First Name" id="akaFirstName"
                                        type="text" pattern="[A-Za-z]+" message-when-pattern-mismatch="Aka first name should only contain letters." value={akaFirstName} onchange={handleInputChange}
                                        >
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item style="flex-basis: 20%;" size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-searchCardInputLabel" name="extradictedFrom" label="Extradicted From" id="extradictedFrom"
                                        type="text" value={extradictedFrom} onchange={handleInputChange} pattern="^$|^[A-Za-z]+$" 
                                        message-when-pattern-mismatch="Extradicted from field should only contain letters."
                                        >
                                    </lightning-input>
                                </lightning-layout-item>
                            </lightning-layout>
                        </div>
                        <div class="searchInputFieldsAndComboboxContainer">
                            <lightning-layout style="width: 120%" multiple-rows>
                                <lightning-layout-item size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-searchCardInputLabel" name="extradictedFileNo" label="Extradicted File No." id="extradictedFileNo"
                                        type="text" value={extradictedFileNo} onchange={handleInputChange} pattern="[0-9]+" message-when-pattern-mismatch="Extradicted file number should only contain digits."
                                        >
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item size="2" class="slds-p-right_medium">
                                    <lightning-combobox class="SE-notvalidate comboboxItemBackgroundColorChange" name="actionYear" label="Governor's Action Year"
                                        id="actionYear" value={actionYear} options={actionYearOptions}
                                        onchange={handleInputChange} placeholder="Select governor's action year">
                                    </lightning-combobox>
                                </lightning-layout-item>
                                <lightning-layout-item size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-notvalidate" name="requestDate" label="Request Date Range" id="requestDate"
                                        type="date" value={requestDate} onchange={handleInputChange} date-style="short"
                                        placeholder="mm/dd/yyyy">
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item size="2" class="slds-p-right_medium">
                                    <lightning-input class="SE-notvalidate" name="responseDate" label="Response Date Range" id="responseDate"
                                        type="date" value={responseDate} onchange={handleInputChange} date-style="short"
                                        placeholder="mm/dd/yyyy">
                                    </lightning-input>
                                </lightning-layout-item>
                                <lightning-layout-item size="2" class="slds-p-right_medium">
                                    <lightning-combobox class="SE-notvalidate comboboxItemBackgroundColorChange" name="office" label="Office"
                                        id="office" value={office} options={officeOptions}
                                        onchange={handleInputChange} placeholder="Select Office">
                                    </lightning-combobox>
                                </lightning-layout-item>
                            </lightning-layout>
                        </div>

                    </div>
                    <div class="SE-footer">
                        <div class="button-group">
                            <div class="clear-all" onclick={handleClear}>
                                <span class="clear-icon-wrapper">
                                    <lightning-icon icon-name="utility:close" size="xx-small" class="clear-icon"></lightning-icon>
                                </span>
                                <span class="clear-text">Clear All</span>
                            </div>
                            <lightning-button icon-name="utility:search" variant="brand" alternative-text="Search"
                                label="Search" onclick={handleSearch} title="Search" class="customButton">
                            </lightning-button>
                        </div>
                    </div>
                </div>
                <template if:true={isLoading}>
                    <div class="spinner-container">
                        <lightning-spinner alternative-text="Loading..." variant="brand" size="large"></lightning-spinner>
                    </div>
                </template>
                <template if:false={isLoading}>
                <div class="SE-Card SE-searchCardContent secondDivForDataTable">
                    <div class="slds-grid slds-grid_align-end">
                        <div class="buttoncontainerfilter buttoncontainerfilter">

                            <div class="left-button">
                                <span class="slds-text-title_bold slds-m-right_x-small">Search Results:</span>
                                <lightning-badge label={recordCountValue} class="totoalcountbadge">
                                </lightning-badge>
                            </div>

                            <div class="right-buttons">
                                <lightning-badge data-id="today" label="Today" class={badgeClassCurrentDay}
                                    onclick={handleBadgeClick}>
                                </lightning-badge>
                                <lightning-badge data-id="this-week" label="This Week" class={badgeClassThisWeek}
                                    onclick={handleBadgeClick}>
                                </lightning-badge>
                                <lightning-badge data-id="this-month" label="This Month" class={badgeClassThisMonth}
                                    onclick={handleBadgeClick}>
                                </lightning-badge>
                                <lightning-badge data-id="this-quarter" label="This Quarter"
                                    class={badgeClassThisQuarter} onclick={handleBadgeClick}>
                                </lightning-badge>
                                <lightning-badge data-id="this-year" label="This Year" class={badgeClassThisYear}
                                    onclick={handleBadgeClick}>
                                </lightning-badge>

                                <lightning-button label="Add New Request" icon-name="utility:add"
                                    onclick={openAddModal} variant="brand" class="customButton">
                                </lightning-button>

                            </div>
                        </div>
                    </div>
                        <template if:true={recordCount}>
                            <div class="slds-scrollable_x custom-table-container TrHoverBackGroundColorChange">
                                <table class="slds-table slds-table_cell-buffer slds-table_bordered custom-table">
                                <thead>
                                    <tr class="custom-header TrHoverBackGroundColorChange">
                                        <th scope="col" onclick={sortByField} data-field="SAP_Last_Name__c">
                                            <div class="slds-truncate" title="LastName">Last Name
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon" ></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col"  onclick={sortByField} data-field="SAP_First_Name__c">
                                            <div class="slds-truncate" title="First Name">First Name
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon"></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} data-field="SAP_Middle_Name__c">
                                            <div class="slds-truncate" title="MI">Middle Initial
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon" ></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} data-field="SAP_Extradicted_From__c">
                                            <div class="slds-truncate" title="Extradited From">Extradited From
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon" ></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} data-field="SAP_Office__c">
                                            <div class="slds-truncate" title="Extradited From">Office
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon" ></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} data-field="SAP_Extradicted_File_Number__c">
                                            <div class="slds-truncate" title="File Number">File Number
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon" ></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" onclick={sortByField} data-field="Received_for_filling_with_Governor_s_Act__c">
                                            <div class="slds-truncate" title="Received For Filing">Received For Filing
                                                <lightning-icon icon-name={sortIcon} alternative-text="Sort"
                                                    size="x-small" class="sort-icon" ></lightning-icon>
                                            </div>
                                        </th>
                                        <th scope="col" >
                                            <div class="slds-truncate actionMenu" title="Action">Action</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template if:true={isRecordsLoading}>
                                        <tr class="no-border-row TrHoverBackGroundColorChange">
                                            <td colspan="7" class="slds-text-align_center loader-row">
                                                <lightning-spinner alternative-text="Loading records..." variant="brand" size="large"></lightning-spinner>
                                            </td>
                                        </tr>
                                    </template>
                                    <template if:false={isRecordsLoading}>
                                    <template for:each={paginatedResult} for:item="row">
                                        <tr key={row.Id} class="custom-column">
                                            <td>
                                                <div class="slds-truncate" title={row.SAP_Last_Name__c}>{row.SAP_Last_Name__c}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" title={row.SAP_First_Name__c}>{row.SAP_First_Name__c}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" title={row.SAP_Middle_Name__c}>{row.SAP_Middle_Name__c}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" title={row.SAP_Extradicted_From__c}>{row.SAP_Extradicted_From__c}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" title={row.SAP_Office__c}>{row.SAP_Office__c}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" title={row.SAP_Extradicted_File_Number__c}>{row.SAP_Extradicted_File_Number__c}</div>
                                            </td>
                                            <td>
                                                <div class="slds-truncate" title={row.Received_for_filling_with_Governor_s_Act__c}>{row.Received_for_filling_with_Governor_s_Act__c}</div>
                                            </td>
                                            <td>

                                                <lightning-button-menu alternative-text="Actions"
                                                class="slds-button_icon slds-button_icon-inverse custom-button-menu" 
                                                variant="bare"
                                                icon-name="utility:threedots_vertical" 
                                                onselect={handleAction} 
                                                menu-alignment="auto"
                                                data-id={row.Id}
                                                >
                                                    <template if:false={row.isMenuOpen}>
                                                        <lightning-menu-item label="View Request" value="view" data-id={row.Id}></lightning-menu-item>
                                                        <lightning-menu-item label="Edit Request" value="edit" data-id={row.Id}></lightning-menu-item>
                                                    </template>
                                                </lightning-button-menu>
                                            </td>
                                        </tr>
                                    </template>
                                </template>
                                </tbody>
                            </table>
                            </div>

                            <template if:true={showPages}>
                            <div class="pagination-container">
                                
                                        <lightning-button class="pagination-button" label="<< Prev"
                                            onclick={handlePreviousPage} disabled={isPreviousDisabled}
                                            variant="neutral">
                                        </lightning-button>

                                        <div class="page-info">
                                            <span class="page-range">{startRecord}-{endRecord} of {totalRecords} &nbsp;</span>
                                            <span class="page-text"> | Page &nbsp; 
                                                <lightning-input 
                                                type="number" 
                                                value={currentPage} 
                                                label="Current Page" 
                                                variant="label-hidden"
                                                class="current-page-input"
                                                onchange={handlePageChange}>
                                            </lightning-input> &nbsp;
                                            of {totalPages}
                                        </span>
                                        </div>

                                        <lightning-button class="pagination-button" label="Next >>"
                                            onclick={handleNextPage} disabled={isNextDisabled} variant="neutral">
                                        </lightning-button>
                                
                            </div>
                        </template>
                        </template>
                        <template if:false={recordCount}>
                            <p class="no-data-message">“No requests found for the given criteria.”</p>
                        </template>

                </div>
            </template>
            </div>

        </div>
   
    </lightning-card>
</template>