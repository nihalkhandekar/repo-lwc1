<template>
    <lightning-card>
    <div class="dashboard-container">
        <template if:true={isLoading}>
            <div class="spinner-container">
                <lightning-spinner alternative-text="Loading..." variant="brand" size="large"></lightning-spinner>
            </div>
        </template>
        <template if:false={isLoading}>
            <!-- Breadcrumb Navigation -->
            <div class="breadcrumb-container">
                <div class="breadcrumb">
                    <a href="#" onclick={navigateToDashboard}>My Dashboard</a>
                    <lightning-icon
                        class="chevron-icon custom-color slds-icon_x-small"
                        icon-name="utility:chevronright"
                        size="x-small"
                        alternative-text="Chevron Right"
                    ></lightning-icon>
                    <div class="subtextbox">
                        <span>Cancelled Orders</span>
                    </div>
                </div>
            </div>

            <!-- Submitted Requests Card -->
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-icon">
                            <lightning-icon icon-name="action:reject" size="medium" class="dashboard-icon"></lightning-icon>
                        </div>
                        <div class="card-content">
                            <h2 class="card-title">Cancelled Orders</h2>
                            <p class="card-description">Have a look at the orders which got cancelled.</p>
                        </div>
                    </div>
                </div>
                <template if:true={paginatedResult}>
                    <div class="slds-scrollable_x custom-table-container">
                        <table class="slds-table slds-table_cell-buffer slds-table_bordered custom-table">
                            <thead>
                                <tr class="custom-header">
                                    <th scope="col" style="width: 200px; min-width: 200px;" onclick={sortByField} data-field="workOrder">
                                        <div class="slds-truncate" title="Work Order">
                                            Work Order #
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="CreatedDate">
                                        <div class="slds-truncate" title="Created Date">
                                            Work Date
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="Name">
                                        <div class="slds-truncate" title="Requester Name">
                                            Requestor Name<lightning-icon
                                                icon-name={sortIcon}
                                                alternative-text="Sort"
                                                size="x-small"
                                                class="sort-icon"
                                            ></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="documentType">
                                        <div class="slds-truncate" title="Document Type">
                                            Item Description
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="CancellationType">
                                        <div class="slds-truncate" title="Cancellation Type">
                                            Cancellation Type
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="ReasonForCancellation">
                                        <div class="slds-truncate" title="Reason For Cancellation">
                                            Reason For Cancellation
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;" onclick={sortByField} data-field="CancellationDate">
                                        <div class="slds-truncate" title="Cancellation Date">
                                            Cancellation Date
                                            <lightning-icon icon-name={sortIcon} alternative-text="Sort" size="x-small" class="sort-icon"></lightning-icon>
                                        </div>
                                    </th>
                                    <th scope="col" style="width: 150px; min-width: 150px;">
                                        <div class="slds-truncate" title="Action">Action</div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <template if:true={isRecordsLoading}>
                                    <tr class="no-border-row">
                                        <td colspan="8" class="slds-text-align_center loader-row">
                                            <lightning-spinner alternative-text="Loading records..." variant="brand" size="large"></lightning-spinner>
                                        </td>
                                    </tr>
                                </template>
                                <template if:false={isRecordsLoading}>
                                    <template for:each={paginatedResult} for:item="row">
                                    <tr key={row.Id} class="custom-column">
                                        <td class="column1">
                                            <div class="slds-truncate" title={row.workOrder}>{row.workOrder}</div>
                                        </td>
                                        <td class="column2">
                                            <div class="slds-truncate" title={row.AppliedDate}>{row.AppliedDate}</div>
                                        </td>
                                        <td class="column3">
                                            <div class="slds-truncate" title={row.Name}>{row.Name}</div>
                                        </td>
                                        <td class="column4">
                                            <div class="slds-truncate" title={row.documentType}>{row.documentType}</div>
                                        </td>
                                        <td class="column5">
                                            <div class="slds-truncate cancellationType" title={row.CancellationType}>{row.CancellationType}</div>
                                        </td>
                                        <td class="column6">
                                            <div class="slds-truncate" title={row.ReasonForCancellation}>{row.ReasonForCancellation}</div>
                                        </td>
                                        <td class="column7">
                                            <div class="slds-truncate" title={row.CancellationDate}>{row.CancellationDate}</div>
                                        </td>
                                        <td class="column8">
                                            <a href="javascript:void(0)" class="actionView" onclick={handleViewAction} data-id={row.Id}>Reinstate Order</a>
                                        </td>
                                    </tr>
                                </template>
                            </template>
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination controls -->
                    <template if:true={showPages}>
                        <div class="pagination-controls">
                            <lightning-button
                                label="Prev"
                                icon-name="utility:jump_to_left"
                                icon-position="left"
                                onclick={handlePreviousPage}
                                variant="neutral"
                                disabled={isPreviousDisabled}
                            ></lightning-button>
                            <span class="paginationText">{startRecord} - {endRecord} of {totalRecords} | Page {currentPage} of {totalPages}</span>
                            <lightning-button
                                label="Next"
                                icon-name="utility:jump_to_right"
                                icon-position="right"
                                onclick={handleNextPage}
                                variant="neutral"
                                disabled={isNextDisabled}
                            ></lightning-button>
                        </div>
                    </template>
                </template>
                <template if:false={paginatedResult}>
                    <p class="no-data-message">You have no cancelled requests.</p>
                </template>
            </div>

            <!-- Reinstate Order Modal -->
            <template if:true={reinstateOrder}>
                <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open custom-modal">
                    <div class="slds-modal__container custom-modal-container">
                        <header class="slds-modal__header header-content popupheader">
                            <span class="header-label">Reinstate Order</span>
                            <lightning-icon class="close-icon" icon-name="utility:close" size="small" onclick={handleCancel}></lightning-icon>
                        </header>
                        <div class="slds-modal__content slds-p-around_large body-content">
                            <p class="slds-m-top_x-small body-matter">
                                Are you sure you want to reinstate your order request? You can find them later in drafts.
                            </p>
                        </div>
                        <footer class="slds-modal__footer footer-content popupfooter">
                            <button class="no-button" onclick={handleCancel}>No</button>
                            <button class="yes-button" onclick={handleYesOfReinstateRequest}>Yes</button>
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>
        </template>
    </div>
</lightning-card>
</template>